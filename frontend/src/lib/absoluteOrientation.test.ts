const straightUpright = [
	[0.294, 0.634, 0.665, 0.264],
	[0.309, 0.630, 0.661, 0.267],
	[0.301, 0.634, 0.662, 0.263],
	[0.302, 0.612, 0.685, 0.257],
	[0.297, 0.639, 0.660, 0.261],
	[0.313, 0.615, 0.681, 0.244],
	[0.309, 0.652, 0.650, 0.240],
	[0.310, 0.628, 0.676, 0.229],
	[0.290, 0.634, 0.675, 0.241],
	[0.247, 0.592, 0.730, 0.237],
	[0.263, 0.626, 0.703, 0.212],
	[0.274, 0.625, 0.700, 0.210],
	[0.265, 0.643, 0.695, 0.184],
	[0.252, 0.664, 0.679, 0.183],
	[0.194, 0.677, 0.697, 0.137],
	[0.186, 0.677, 0.704, 0.106],
	[0.223, 0.625, 0.732, 0.156],
	[-0.189, 0.638, 0.728, 0.164],
	[-0.193, 0.659, 0.714, 0.139],
	[-0.211, 0.651, 0.719, 0.124],
	[-0.174, 0.643, 0.742, 0.070],
	[-0.112, 0.739, 0.664, 0.003],
	[-0.087, 0.692, 0.717, 0.011],
	[0.085, -0.696, -0.713, 0.006],
	[0.051, -0.714, -0.696, 0.060],
	[0.008, -0.720, -0.693, 0.039],
	[0.020, -0.686, -0.721, 0.098],
	[0.056, -0.715, -0.690, 0.097],
	[0.057, -0.739, -0.667, 0.072],
	[0.154, -0.764, -0.600, 0.182],
	[0.222, -0.730, -0.594, 0.255],
	[0.156, -0.681, -0.665, 0.265],
	[0.211, -0.712, -0.614, 0.269],
	[0.185, -0.667, -0.671, 0.264],
	[0.236, -0.661, -0.664, 0.257],
	[0.251, -0.677, -0.634, 0.276],
	[0.284, -0.690, -0.611, 0.265],
	[0.262, -0.666, -0.626, 0.310],
	[0.295, -0.625, -0.649, 0.318],
	[0.319, -0.637, -0.615, 0.340],
	[0.450, -0.578, -0.505, 0.456],
	[0.449, -0.549, -0.533, 0.461],
	[0.478, -0.528, -0.533, 0.457],
	[0.484, -0.521, -0.521, 0.473],
	[0.502, -0.536, -0.484, 0.476],
	[0.499, -0.517, -0.490, 0.493],
	[0.490, -0.505, -0.517, 0.488],
	[0.522, -0.508, -0.481, 0.488],
	[0.539, -0.482, -0.471, 0.506],
	[0.559, -0.477, -0.461, 0.497],
	[0.569, -0.474, -0.431, 0.515],
	[0.571, -0.441, -0.425, 0.546],
	[0.593, -0.420, -0.391, 0.565],
	[0.599, -0.401, -0.372, 0.585],
	[0.628, -0.379, -0.337, 0.591],
	[0.606, -0.354, -0.360, 0.615],
	[0.635, -0.335, -0.308, 0.625],
	[0.646, -0.308, -0.304, 0.629],
	[0.679, -0.276, -0.256, 0.631],
	[0.691, -0.217, -0.335, 0.603],
	[0.685, -0.247, -0.291, 0.620],
	[0.695, -0.241, -0.261, 0.625],
	[0.709, -0.251, -0.230, 0.617],
	[0.674, -0.210, -0.236, 0.668],
	[0.667, -0.198, -0.205, 0.688],
	[0.684, -0.105, -0.137, 0.708],
	[0.700, -0.040, -0.065, 0.710],
	[0.709, -0.012, -0.061, 0.703],
	[0.710, -0.007, -0.025, 0.703],
	[0.713, -0.027, -0.027, 0.700],
	[0.677, 0.053, 0.065, 0.731],
	[0.670, 0.140, 0.123, 0.718],
	[0.673, 0.168, 0.184, 0.697],
	[0.628, 0.237, 0.225, 0.706],
	[0.653, 0.231, 0.243, 0.679],
	[0.654, 0.257, 0.239, 0.670],
	[0.633, 0.281, 0.237, 0.681],
	[0.645, 0.261, 0.278, 0.662],
	[0.680, 0.296, 0.225, 0.631],
	[0.648, 0.298, 0.262, 0.650],
	[0.621, 0.347, 0.292, 0.639],
	[0.543, 0.399, 0.400, 0.621],
	[0.615, 0.369, 0.330, 0.614],
	[0.533, 0.470, 0.451, 0.541],
	[0.488, 0.485, 0.485, 0.540],
	[0.481, 0.490, 0.502, 0.525],
	[0.457, 0.481, 0.547, 0.511],
	[0.482, 0.497, 0.539, 0.479],
	[0.469, 0.486, 0.559, 0.481],
	[0.374, 0.532, 0.619, 0.442],
	[0.313, 0.569, 0.667, 0.366],
	[0.350, 0.575, 0.643, 0.365],
	[0.310, 0.593, 0.649, 0.362],
	[0.287, 0.590, 0.677, 0.334],
	[0.310, 0.608, 0.657, 0.320],
	[0.322, 0.602, 0.637, 0.358],
	[0.330, 0.593, 0.646, 0.349],
	[0.314, 0.604, 0.648, 0.340],
	[0.378, 0.578, 0.615, 0.381],
	[0.367, 0.576, 0.619, 0.389],

]

// window.AbsoluteOrientationSensor({frequency: 10, referenceFrame: "device"}); values for different expected exif orientations

// exif orientation code 1
const portraitQuaternions = [
	[0.686, 0.310, 0.286, 0.593],
	[0.675, 0.300, 0.294, 0.607],
	[0.687, 0.299, 0.292, 0.594],
	[0.671, 0.300, 0.308, 0.604],
	[0.673, 0.288, 0.335, 0.593],
	[0.674, 0.276, 0.359, 0.584],
	[0.657, 0.302, 0.318, 0.613],
	[0.644, 0.250, 0.342, 0.637],
	[0.597, 0.195, 0.371, 0.684],
	[0.602, 0.218, 0.339, 0.689],
	[0.548, 0.220, 0.333, 0.736],
	[0.542, 0.288, 0.253, 0.748],
	[0.509, 0.367, 0.204, 0.752],
	[0.554, 0.326, 0.151, 0.751],
	[0.736, 0.165, 0.085, 0.651],
	[0.787, 0.172, 0.148, 0.574],
	[0.813, 0.087, 0.225, 0.529],
	[0.840, 0.066, 0.212, 0.495],
	[0.847, 0.055, 0.133, 0.512],
	[0.825, 0.095, 0.124, 0.543],
	[0.838, 0.116, 0.076, 0.527],
	[0.813, 0.182, 0.007, 0.553],
	[0.786, 0.292, 0.106, 0.535],
	[0.806, 0.274, 0.197, 0.486],
	[0.776, 0.331, 0.199, 0.498],
	[0.756, 0.340, 0.272, 0.489],
	[0.768, 0.347, 0.298, 0.449],
	[0.737, 0.390, 0.392, 0.389],
	[0.655, 0.427, 0.487, 0.389],
	[0.666, 0.444, 0.489, 0.347],
	[0.651, 0.448, 0.498, 0.358],
	[0.659, 0.418, 0.530, 0.331],
	[0.545, 0.231, 0.619, 0.517],
	[0.575, 0.134, 0.511, 0.625],
	[0.573, 0.095, 0.463, 0.670],
	[0.546, 0.092, 0.447, 0.703],
	[0.514, 0.085, 0.445, 0.728],
	[0.518, 0.159, 0.414, 0.731],
	[0.529, 0.210, 0.365, 0.737],
	[0.517, 0.229, 0.348, 0.748],
	[0.511, 0.251, 0.329, 0.754],
	[0.522, 0.270, 0.310, 0.747],
	[0.548, 0.274, 0.283, 0.738],
	[0.544, 0.306, 0.266, 0.734],
	[0.514, 0.361, 0.245, 0.738],
	[0.528, 0.370, 0.255, 0.721],
	[0.598, 0.331, 0.213, 0.698],
	[0.718, 0.228, 0.074, 0.653],
	[0.735, 0.194, 0.037, 0.648],
	[0.775, 0.199, 0.045, 0.598],
	[0.757, 0.279, 0.093, 0.584],
	[0.742, 0.292, 0.155, 0.584],
	[0.748, 0.317, 0.197, 0.549],
	[0.739, 0.320, 0.242, 0.541],
	[0.733, 0.354, 0.233, 0.531],
	[0.759, 0.351, 0.281, 0.470],
	[0.723, 0.387, 0.355, 0.449],
	[0.694, 0.444, 0.434, 0.366],
	[0.677, 0.458, 0.462, 0.344],
	[0.683, 0.466, 0.464, 0.319],
	[0.635, 0.446, 0.512, 0.368],
	[0.556, 0.333, 0.583, 0.490],
	[0.602, 0.423, 0.510, 0.445],
	[0.554, 0.374, 0.520, 0.531],
	[0.533, 0.414, 0.488, 0.553],
	[0.507, 0.409, 0.498, 0.571],
	[0.537, 0.415, 0.436, 0.591],
	[0.504, 0.441, 0.472, 0.573],
	[0.431, 0.449, 0.524, 0.581],
	[0.399, 0.488, 0.525, 0.572],
	[0.292, 0.548, 0.577, 0.531],
	[0.171, 0.608, 0.657, 0.412],
	[0.135, 0.620, 0.680, 0.367],
	[0.127, 0.647, 0.669, 0.343],
	[0.159, 0.649, 0.634, 0.390],
	[0.474, 0.592, 0.342, 0.555],
	[0.553, 0.506, 0.288, 0.596],
	[0.633, 0.440, 0.172, 0.613],
	[0.523, 0.561, 0.319, 0.557],
	[0.539, 0.574, 0.321, 0.527],
	[0.522, 0.590, 0.361, 0.499],
	[0.523, 0.608, 0.365, 0.473],
	[0.528, 0.601, 0.381, 0.464],
	[0.500, 0.585, 0.464, 0.439],
	[0.434, 0.584, 0.606, 0.322],
	[0.392, 0.614, 0.627, 0.277],
	[0.353, 0.585, 0.664, 0.305],
	[0.339, 0.566, 0.684, 0.312],
	[0.315, 0.566, 0.700, 0.301],
	[0.254, 0.592, 0.705, 0.298],
	[0.194, 0.626, 0.700, 0.283],
	[0.132, 0.643, 0.709, 0.259],
	[0.008, 0.656, 0.742, 0.137],
	[0.032, 0.640, 0.761, 0.107],
	[0.041, 0.665, 0.738, 0.106],
	[0.040, 0.669, 0.737, 0.091],
	[0.070, 0.656, 0.748, 0.077],
	[0.097, 0.659, 0.743, 0.065],
	[0.145, 0.645, 0.747, 0.069],
	[0.164, 0.639, 0.751, 0.033],
	[0.200, 0.641, 0.741, 0.023],
	[0.116, 0.726, 0.676, 0.043],
	[0.072, 0.737, 0.665, 0.095],
	[0.057, 0.740, 0.661, 0.111],
	[0.032, 0.741, 0.665, 0.089],
	[0.007, 0.749, 0.660, 0.063],
	[0.007, 0.760, 0.649, 0.032],
	[0.001, 0.759, 0.651, 0.022],
	[0.011, 0.752, 0.659, 0.010],
	[0.015, 0.731, 0.682, 0.013],
	[0.018, -0.722, -0.690, 0.044],
	[0.045, -0.720, -0.687, 0.086],
	[0.067, -0.662, -0.744, 0.062],
	[0.054, -0.631, -0.772, 0.055],
	[0.030, -0.588, -0.807, 0.052],
	[0.009, -0.545, -0.836, 0.061],
	[0.025, -0.520, -0.850, 0.082],
	[0.074, -0.513, -0.842, 0.151],
	[0.233, -0.488, -0.811, 0.221],
	[0.239, -0.436, -0.827, 0.262],
	[0.270, -0.447, -0.810, 0.267],
	[0.289, -0.452, -0.793, 0.287],
	[0.337, -0.432, -0.782, 0.297],
	[0.373, -0.386, -0.793, 0.289],
	[0.380, -0.404, -0.777, 0.297],
	[0.421, -0.410, -0.731, 0.348],
	[0.491, -0.419, -0.661, 0.383],
	[0.559, -0.511, -0.569, 0.321],
	[0.496, -0.547, -0.611, 0.284],
	[0.415, -0.637, -0.612, 0.218],
	[0.394, -0.664, -0.592, 0.230],
	[0.392, -0.666, -0.588, 0.239],
	[0.360, -0.692, -0.563, 0.274],
	[0.345, -0.711, -0.531, 0.304],
	[0.360, -0.704, -0.508, 0.341],
	[0.302, -0.711, -0.541, 0.334],
	[0.259, -0.712, -0.563, 0.331],
	[0.224, -0.701, -0.590, 0.333],
	[0.230, -0.695, -0.588, 0.344],
	[0.156, -0.656, -0.646, 0.358],
	[0.043, -0.627, -0.755, 0.188],
	[0.038, -0.579, -0.804, 0.127],
	[0.026, -0.593, -0.791, 0.150],
	[0.126, -0.547, -0.781, 0.272],
	[0.183, -0.540, -0.771, 0.282],
	[0.224, -0.524, -0.764, 0.302],
	[0.237, -0.486, -0.775, 0.326],
	[0.283, -0.470, -0.769, 0.327],
	[0.335, -0.474, -0.735, 0.350],
	[0.404, -0.441, -0.685, 0.416],
	[0.456, -0.418, -0.641, 0.455],
	[0.492, -0.427, -0.610, 0.452],
	[0.520, -0.441, -0.583, 0.442],
	[0.536, -0.505, -0.551, 0.392],
	[0.545, -0.512, -0.537, 0.391],
	[0.568, -0.516, -0.522, 0.373],
	[0.594, -0.516, -0.505, 0.354],
	[0.607, -0.533, -0.465, 0.362],
	[0.638, -0.532, -0.432, 0.351],
	[0.614, -0.515, -0.455, 0.388],
	[0.586, -0.516, -0.444, 0.440],
	[0.570, -0.530, -0.400, 0.484],
	[0.542, -0.526, -0.395, 0.523],
	[0.554, -0.518, -0.386, 0.525],
	[0.542, -0.495, -0.409, 0.542],
	[0.521, -0.484, -0.432, 0.554],
	[0.446, -0.466, -0.515, 0.565],
	[0.414, -0.455, -0.557, 0.558],
	[0.433, -0.417, -0.577, 0.553],
	[0.424, -0.403, -0.583, 0.564],
	[0.432, -0.381, -0.596, 0.560],
	[0.493, -0.344, -0.586, 0.544],
	[0.557, -0.291, -0.574, 0.525],
	[0.578, -0.280, -0.524, 0.559],
	[0.593, -0.298, -0.513, 0.544],
	[0.621, -0.435, -0.512, 0.404],
	[0.652, -0.483, -0.487, 0.323],
	[0.652, -0.489, -0.476, 0.331],
	[0.652, -0.502, -0.462, 0.329],
	[0.647, -0.522, -0.446, 0.332],
	[0.641, -0.529, -0.423, 0.361],
	[0.640, -0.535, -0.400, 0.379],
	[0.637, -0.538, -0.383, 0.397],
	[0.628, -0.542, -0.361, 0.427],
	[0.599, -0.543, -0.341, 0.480],
	[0.593, -0.526, -0.317, 0.521],
	[0.634, -0.456, -0.255, 0.570],
	[0.627, -0.420, -0.239, 0.611],
	[0.442, -0.508, -0.436, 0.597],
	[0.304, -0.553, -0.570, 0.525],
	[0.243, -0.585, -0.614, 0.471],
	[0.223, -0.543, -0.643, 0.492],
	[0.302, -0.484, -0.633, 0.523],
	[0.305, -0.447, -0.612, 0.576],
	[0.304, -0.416, -0.620, 0.591],
	[0.317, -0.387, -0.633, 0.591],
	[0.360, -0.369, -0.616, 0.596],
	[0.401, -0.333, -0.600, 0.607],
	[0.463, -0.282, -0.589, 0.599],
	[0.519, -0.211, -0.511, 0.652],
	[0.554, -0.179, -0.457, 0.672],
	[0.582, -0.168, -0.442, 0.661],
	[0.587, -0.191, -0.437, 0.654],
	[0.608, -0.198, -0.435, 0.634],
	[0.662, -0.342, -0.471, 0.473],
	[0.652, -0.436, -0.484, 0.388],
	[0.643, -0.460, -0.477, 0.385],
	[0.622, -0.484, -0.455, 0.415],
	[0.625, -0.508, -0.412, 0.427],
	[0.623, -0.514, -0.383, 0.449],
	[0.614, -0.506, -0.371, 0.479],
	[0.616, -0.490, -0.333, 0.519],
	[0.634, -0.451, -0.265, 0.569],
	[0.648, -0.414, -0.223, 0.599],
	[0.635, -0.408, -0.204, 0.624],
	[0.631, -0.395, -0.171, 0.645],
	[0.426, -0.519, -0.418, 0.612],
	[0.345, -0.535, -0.527, 0.563],
	[0.245, -0.565, -0.636, 0.466],
	[0.220, -0.559, -0.684, 0.413],
	[0.246, -0.571, -0.676, 0.395],
	[0.275, -0.574, -0.673, 0.375],
	[0.281, -0.617, -0.643, 0.357],
	[0.287, -0.635, -0.634, 0.334],
	[0.226, -0.655, -0.640, 0.332],
	[0.152, -0.673, -0.657, 0.306],
	[0.220, -0.686, -0.633, 0.285],
	[0.183, -0.750, -0.551, 0.317],
	[0.130, -0.718, -0.637, 0.250],
	[0.035, -0.734, -0.671, 0.096],
	[0.075, -0.724, -0.683, 0.065],
	[0.128, -0.661, -0.740, 0.016],
	[-0.259, 0.602, 0.753, 0.058],
	[-0.296, 0.666, 0.673, 0.127],
	[-0.295, 0.608, 0.709, 0.202],
	[-0.342, 0.550, 0.735, 0.203],
	[0.340, 0.549, 0.727, 0.232],
	[0.334, 0.555, 0.722, 0.244],
	[0.333, 0.567, 0.710, 0.253],
	[0.334, 0.571, 0.702, 0.263],
	[0.341, 0.568, 0.698, 0.272],
	[0.347, 0.558, 0.699, 0.282],
	[0.359, 0.561, 0.685, 0.295],
	[0.375, 0.548, 0.673, 0.326],
	[0.393, 0.526, 0.661, 0.364],
	[0.439, 0.499, 0.611, 0.430],
	[0.457, 0.485, 0.585, 0.463],
	[0.473, 0.493, 0.547, 0.484],
	[0.479, 0.485, 0.538, 0.495],
	[0.480, 0.463, 0.546, 0.507],
	[0.480, 0.480, 0.510, 0.528],
	[0.498, 0.487, 0.484, 0.529],
	[0.494, 0.464, 0.492, 0.547],
	[0.538, 0.425, 0.445, 0.576],
	[0.567, 0.352, 0.385, 0.637],
	[0.603, 0.306, 0.318, 0.665],
	[0.621, 0.278, 0.280, 0.678],
	[0.636, 0.243, 0.249, 0.688],
	[0.653, 0.207, 0.223, 0.693],
	[0.672, 0.132, 0.112, 0.720],
	[0.697, 0.071, 0.059, 0.711],
	[0.674, 0.060, 0.018, 0.736],
	[0.681, 0.034, 0.013, 0.731],
	[0.685, 0.014, 0.054, 0.727],
	[0.701, -0.029, 0.063, 0.710],
	[0.694, -0.111, -0.133, 0.699],
	[0.700, -0.160, -0.236, 0.654],
	[0.682, -0.216, -0.270, 0.645],
	[0.674, -0.235, -0.287, 0.639],
	[0.664, -0.227, -0.304, 0.644],
	[0.669, -0.252, -0.311, 0.626],
	[0.665, -0.277, -0.306, 0.623],
	[0.657, -0.282, -0.298, 0.633],
	[0.659, -0.264, -0.307, 0.633],
	[0.661, -0.202, -0.315, 0.651],
	[0.673, -0.194, -0.279, 0.657],
	[0.675, -0.222, -0.239, 0.661],
	[0.711, -0.133, -0.088, 0.685],
	[0.713, -0.045, -0.027, 0.699],
	[0.693, -0.002, -0.028, 0.720],
	[0.661, -0.046, -0.006, 0.749],
	[0.652, 0.074, 0.037, 0.754],
	[0.686, 0.060, 0.058, 0.722],
	[0.647, 0.152, 0.141, 0.734],
	[0.596, 0.250, 0.234, 0.727],
	[0.572, 0.249, 0.318, 0.714],
	[0.552, 0.290, 0.364, 0.692],
	[0.535, 0.380, 0.428, 0.621],
	[0.536, 0.411, 0.426, 0.602],
	[0.459, 0.466, 0.480, 0.584],
	[0.457, 0.483, 0.492, 0.561],
	[0.441, 0.496, 0.495, 0.561],
	[0.440, 0.483, 0.509, 0.561],
	[0.424, 0.499, 0.515, 0.553],
	[0.428, 0.512, 0.508, 0.545],
	[0.442, 0.514, 0.509, 0.531],
	[0.457, 0.506, 0.518, 0.516],
	[0.425, 0.489, 0.542, 0.534],
	[0.425, 0.472, 0.576, 0.514],
	[0.424, 0.500, 0.562, 0.505],
	[0.406, 0.494, 0.576, 0.509],
	[0.430, 0.503, 0.559, 0.499],
	[0.426, 0.486, 0.578, 0.498],
	[0.411, 0.496, 0.586, 0.492],
	[0.393, 0.505, 0.618, 0.458],
	[0.363, 0.495, 0.660, 0.433],
	[0.420, 0.512, 0.613, 0.431],
	[0.364, 0.571, 0.620, 0.397],
	[0.258, 0.600, 0.681, 0.332],
	[0.290, 0.622, 0.674, 0.273],
	[0.246, 0.657, 0.659, 0.270],
	[0.194, 0.671, 0.673, 0.244],
	[0.032, 0.634, 0.754, 0.166],
	[0.098, 0.643, 0.756, 0.074],
	[0.312, 0.582, 0.731, 0.168],
	[0.324, 0.538, 0.748, 0.214],
	[-0.344, 0.539, 0.738, 0.216],
	[-0.407, 0.457, 0.769, 0.184],
	[-0.362, 0.449, 0.785, 0.227],
];


// 8
const leftLandscapeQuaternions = [
	[0.234, -0.698, 0.211, 0.643],
	[0.240, -0.693, 0.220, 0.643],
	[0.625, -0.259, 0.682, 0.277],
	[0.618, -0.265, 0.682, 0.286],
	[0.234, -0.698, 0.211, 0.643],
	[0.617, -0.258, 0.690, 0.279],
	[0.230, -0.702, 0.205, 0.642],
	[0.233, -0.698, 0.210, 0.644],
	[0.591, -0.278, 0.693, 0.307],
	[0.232, -0.714, 0.194, 0.631],
	[0.220, -0.740, 0.157, 0.616],
	[0.495, -0.293, 0.758, 0.309],
	[0.537, -0.235, 0.776, 0.233],
	[0.508, -0.230, 0.808, 0.191],
	[0.471, -0.252, 0.826, 0.180],
	[0.443, -0.296, 0.812, 0.239],
	[0.412, -0.324, 0.829, 0.198],
	[0.436, -0.293, 0.833, 0.175],
	[0.439, -0.292, 0.831, 0.175],
	[0.433, -0.299, 0.832, 0.176],
	[0.457, -0.275, 0.827, 0.177],
	[0.447, -0.286, 0.830, 0.174],
	[0.437, -0.291, 0.834, 0.171],
	[0.452, -0.276, 0.831, 0.170],
	[0.508, -0.226, 0.815, 0.165],
	[0.549, -0.193, 0.796, 0.165],
	[0.597, -0.177, 0.761, 0.180],
	[0.620, -0.223, 0.712, 0.243],
	[0.225, -0.708, 0.196, 0.640],
	[0.237, -0.683, 0.225, 0.653],
	[0.248, -0.675, 0.239, 0.653],
	[0.270, -0.675, 0.258, 0.636],
	[0.310, -0.686, 0.280, 0.596],
	[0.343, -0.689, 0.305, 0.561],
	[0.370, -0.687, 0.325, 0.534],
	[0.376, -0.686, 0.327, 0.530],
	[0.379, -0.689, 0.329, 0.523],
	[0.360, -0.680, 0.319, 0.553],
	[0.320, -0.674, 0.294, 0.598],
	[0.278, -0.672, 0.263, 0.633],
	[0.231, -0.701, 0.206, 0.642],
	[0.592, -0.261, 0.706, 0.287],
	[0.191, -0.754, 0.125, 0.616],
	[0.203, -0.762, 0.117, 0.603],
	[0.212, -0.766, 0.115, 0.596],
	[0.205, -0.761, 0.121, 0.603],
	[0.536, -0.299, 0.714, 0.337],
	[0.174, -0.770, 0.094, 0.607],
	[0.217, -0.766, 0.116, 0.593],
	[0.538, -0.296, 0.716, 0.331],
	[0.196, -0.769, 0.103, 0.599],
	[0.255, -0.738, 0.173, 0.600],
	[0.518, -0.336, 0.686, 0.386],
	[0.514, -0.326, 0.697, 0.379],
	[0.541, -0.328, 0.678, 0.374],
	[0.280, -0.708, 0.223, 0.609],
	[0.588, -0.318, 0.657, 0.348],
	[0.600, -0.303, 0.661, 0.332],
	[0.619, -0.300, 0.653, 0.318],
	[0.602, -0.264, 0.685, 0.313],
	[0.601, -0.251, 0.694, 0.307],
	[0.604, -0.248, 0.695, 0.302],
	[0.603, -0.258, 0.689, 0.310],
	[0.599, -0.281, 0.676, 0.325],
	[0.592, -0.333, 0.640, 0.360],
	[0.571, -0.375, 0.612, 0.399],
	[0.520, -0.389, 0.620, 0.440],
	[0.369, -0.690, 0.263, 0.564],
	[0.417, -0.689, 0.252, 0.536],
	[0.357, -0.465, 0.568, 0.577],
	[0.386, -0.469, 0.553, 0.571],
	[0.372, -0.471, 0.548, 0.583],
	[0.459, -0.622, 0.356, 0.525],
	[0.464, -0.467, 0.539, 0.525],
	[0.468, -0.552, 0.445, 0.527],
	[0.522, -0.464, 0.536, 0.475],
	[0.526, -0.456, 0.542, 0.470],
	[0.524, -0.447, 0.550, 0.473],
	[0.519, -0.430, 0.566, 0.475],
	[0.486, -0.529, 0.472, 0.511],
	[0.489, -0.544, 0.455, 0.508],
	[0.410, -0.490, 0.512, 0.574],
	[0.417, -0.497, 0.505, 0.570],
	[0.353, -0.511, 0.482, 0.618],
	[0.278, -0.523, 0.449, 0.669],
	[0.248, -0.547, 0.396, 0.695],
	[0.301, -0.537, 0.431, 0.660],
	[0.359, -0.530, 0.452, 0.621],
	[0.360, -0.527, 0.457, 0.619],
	[0.361, -0.526, 0.459, 0.618],
	[0.407, -0.518, 0.473, 0.585],
	[0.435, -0.519, 0.476, 0.561],
	[0.428, -0.488, 0.504, 0.570],
	[0.422, -0.479, 0.511, 0.576],
	[0.428, -0.474, 0.515, 0.572],
	[0.440, -0.457, 0.527, 0.565],
	[0.448, -0.446, 0.536, 0.560],
	[0.429, -0.460, 0.522, 0.576],
	[0.420, -0.474, 0.509, 0.583],
	[0.422, -0.477, 0.508, 0.580],
	[0.415, -0.479, 0.505, 0.586],
	[0.381, -0.500, 0.481, 0.611],
	[0.307, -0.536, 0.415, 0.668],
	[0.238, -0.563, 0.347, 0.711],
	[0.145, -0.570, 0.274, 0.760],
	[0.121, -0.575, 0.240, 0.773],
	[0.004, -0.559, 0.148, 0.816],
	[0.078, -0.543, 0.035, 0.835],
	[0.040, -0.574, 0.141, 0.805],
	[0.162, -0.571, 0.263, 0.761],
	[0.225, -0.558, 0.325, 0.730],
	[0.328, -0.505, 0.445, 0.663],
	[0.281, -0.534, 0.389, 0.696],
	[0.289, -0.529, 0.393, 0.695],
	[0.403, -0.450, 0.523, 0.601],
	[0.429, -0.429, 0.549, 0.575],
	[0.424, -0.425, 0.550, 0.581],
	[0.417, -0.439, 0.535, 0.589],
	[0.379, -0.476, 0.491, 0.624],
	[0.301, -0.521, 0.408, 0.686],
	[0.217, -0.556, 0.317, 0.737],
	[0.188, -0.560, 0.287, 0.754],
	[0.260, -0.557, 0.352, 0.706],
	[0.351, -0.532, 0.433, 0.637],
	[0.171, -0.608, 0.224, 0.743],
	[0.412, -0.493, 0.495, 0.586],
	[0.543, -0.329, 0.658, 0.404],
	[0.636, -0.076, 0.761, 0.105],
	[0.620, -0.172, 0.732, 0.225],
	[0.626, -0.050, 0.778, 0.030],
	[0.521, -0.278, 0.737, 0.328],
	[0.554, -0.277, 0.717, 0.320],
	[0.564, -0.268, 0.718, 0.308],
	[0.603, -0.215, 0.729, 0.241],
	[0.587, -0.210, 0.740, 0.254],
	[0.657, -0.025, 0.753, 0.022],
	[0.644, -0.013, 0.765, 0.013],
	[0.651, -0.003, 0.759, 0.008],
	[0.659, -0.035, 0.751, 0.037],
	[0.669, -0.061, 0.738, 0.063],
	[0.674, -0.041, 0.737, 0.043],
	[0.677, -0.030, 0.735, 0.031],
	[0.678, -0.005, 0.735, 0.003],
	[0.655, -0.054, 0.751, 0.057],
	[0.666, -0.078, 0.737, 0.080],
	[0.644, -0.145, 0.735, 0.155],
	[-0.614, 0.214, -0.722, 0.234],
	[-0.604, 0.247, -0.707, 0.271],
	[-0.605, 0.241, -0.711, 0.266],
	[-0.609, 0.223, -0.718, 0.252],
	[-0.641, -0.202, -0.708, 0.219],
	[-0.644, -0.159, -0.727, 0.175],
	[-0.667, -0.084, -0.734, 0.092],
	[-0.680, -0.099, -0.719, 0.107],
	[-0.682, -0.080, -0.721, 0.087],
	[-0.054, -0.719, -0.053, 0.691],
	[-0.029, -0.711, -0.029, 0.702],
	[-0.664, -0.082, -0.738, 0.084],
	[-0.008, -0.741, -0.014, 0.671],
	[-0.642, -0.121, -0.747, 0.124],
	[-0.622, -0.128, -0.762, 0.132],
	[-0.650, -0.109, -0.744, 0.111],
	[-0.651, -0.114, -0.741, 0.121],
	[-0.681, -0.076, -0.724, 0.079],
	[-0.667, -0.054, -0.741, 0.061],
	[-0.683, -0.039, -0.728, 0.044],
	[-0.683, -0.031, -0.729, 0.036],
	[-0.658, -0.008, -0.752, 0.022],
	[-0.054, -0.712, -0.052, 0.698],
	[-0.694, -0.031, -0.719, 0.033],
	[-0.006, -0.734, -0.003, 0.679],
	[-0.039, -0.753, -0.046, 0.655],
	[-0.071, -0.767, -0.081, 0.632],
	[-0.613, 0.085, -0.783, 0.059],
	[-0.132, 0.787, -0.152, 0.583],
	[-0.258, 0.770, -0.247, 0.528],
	[-0.273, 0.747, -0.251, 0.551],
	[-0.252, 0.752, -0.236, 0.561],
	[-0.648, 0.024, -0.762, 0.008],
	[-0.061, 0.755, -0.065, 0.649],
	[-0.020, 0.765, -0.025, 0.643],
	[-0.008, 0.739, -0.009, 0.674],
	[-0.005, 0.728, -0.005, 0.686],
	[-0.038, -0.751, -0.041, 0.657],
	[-0.074, 0.751, -0.077, 0.651],
	[-0.108, 0.753, -0.110, 0.640],
	[-0.169, 0.754, -0.163, 0.614],
	[-0.125, 0.774, -0.135, 0.606],
	[-0.148, 0.777, -0.158, 0.591],
	[-0.595, 0.108, -0.792, 0.085],
	[-0.131, 0.766, -0.134, 0.614],
	[-0.655, 0.029, -0.755, 0.017],
	[-0.084, 0.741, -0.084, 0.661],
	[0.082, -0.734, 0.080, 0.669],
	[0.062, -0.738, 0.058, 0.670],
	[0.057, -0.741, 0.053, 0.667],
	[0.026, -0.753, 0.017, 0.657],
	[0.007, -0.783, 0.021, 0.621],
	[0.014, -0.779, 0.012, 0.627],
	[0.047, -0.733, 0.041, 0.678],
	[0.064, -0.742, 0.057, 0.665],
	[0.165, -0.734, 0.154, 0.640],
	[0.637, -0.020, 0.771, 0.005],
	[0.579, -0.110, 0.805, 0.067],
	[0.573, -0.117, 0.808, 0.073],
	[0.585, -0.103, 0.802, 0.065],
	[0.577, -0.106, 0.807, 0.066],
	[0.620, -0.042, 0.784, 0.018],
	[0.646, -0.014, 0.762, 0.030],
	[0.667, -0.072, 0.737, 0.084],
	[0.643, -0.209, 0.703, 0.222],
	[0.626, -0.190, 0.725, 0.216],
	[0.621, -0.211, 0.718, 0.233],
	[0.633, -0.229, 0.697, 0.247],
	[0.635, -0.210, 0.705, 0.234],
	[0.622, -0.170, 0.733, 0.216],
	[0.608, -0.131, 0.757, 0.199],
	[0.604, -0.121, 0.763, 0.195],
	[0.612, -0.145, 0.750, 0.206],
	[0.608, -0.178, 0.737, 0.234],
	[0.625, -0.234, 0.696, 0.264],
	[0.588, -0.259, 0.703, 0.305],
	[0.607, -0.244, 0.701, 0.283],
	[0.617, -0.249, 0.691, 0.282],
	[0.637, -0.236, 0.687, 0.258],
	[0.632, -0.231, 0.692, 0.260],
	[0.315, -0.664, 0.296, 0.610],
	[0.315, -0.669, 0.291, 0.607],
	[0.303, -0.664, 0.285, 0.621],
	[0.295, -0.666, 0.280, 0.625],
	[0.293, -0.667, 0.277, 0.627],
	[0.274, -0.669, 0.263, 0.639],
	[0.274, -0.675, 0.260, 0.633],
	[0.258, -0.699, 0.231, 0.626],
	[0.275, -0.682, 0.257, 0.627],
	[0.254, -0.687, 0.239, 0.637],
	[0.238, -0.691, 0.225, 0.644],
	[0.230, -0.684, 0.222, 0.656],
	[0.204, -0.698, 0.193, 0.659],
	[0.174, -0.712, 0.161, 0.661],
	[0.121, -0.721, 0.113, 0.672],
	[0.097, -0.719, 0.093, 0.681],
	[0.057, -0.718, 0.054, 0.692],
	[0.052, -0.722, 0.049, 0.688],
	[0.045, -0.754, 0.037, 0.655],
	[0.040, -0.746, 0.035, 0.663],
	[0.027, -0.774, 0.018, 0.633],
	[0.033, -0.784, 0.021, 0.619],
	[0.032, -0.799, 0.018, 0.600],
	[0.034, -0.807, 0.020, 0.590],
	[0.029, -0.786, 0.019, 0.618],
	[0.029, -0.763, 0.024, 0.645],
	[0.034, -0.730, 0.033, 0.681],
	[0.681, -0.001, 0.733, 0.004],
	[0.669, -0.011, 0.743, 0.006],
	[0.643, -0.026, 0.765, 0.018],
	[0.649, -0.026, 0.760, 0.020],
	[-0.667, 0.029, -0.744, 0.025],
	[-0.015, 0.727, -0.016, 0.686],
	[-0.017, 0.762, -0.017, 0.647],
	[-0.001, 0.772, -0.001, 0.635],
	[-0.023, 0.783, -0.025, 0.621],
	[-0.010, -0.787, -0.008, 0.617],
	[-0.032, -0.729, -0.033, 0.683],
	[-0.697, -0.016, -0.717, 0.017],
	[-0.654, -0.045, -0.754, 0.053],
	[-0.629, -0.053, -0.773, 0.064],
	[-0.665, -0.063, -0.741, 0.069],
	[-0.043, -0.718, -0.040, 0.693],
	[-0.021, -0.750, -0.012, 0.661],
	[-0.011, -0.790, -0.010, 0.613],
	[-0.011, -0.806, -0.007, 0.592],
	[-0.032, -0.769, -0.019, 0.638],
	[-0.090, -0.721, -0.085, 0.681],
	[-0.097, -0.715, -0.092, 0.686],
	[-0.686, -0.158, -0.692, 0.160],
	[-0.635, -0.234, -0.693, 0.250],
	[-0.003, -0.756, -0.017, 0.654],
	[-0.045, -0.780, -0.063, 0.620],
	[-0.040, -0.787, -0.061, 0.612],
	[-0.024, -0.818, -0.057, 0.571],
	[-0.001, -0.833, -0.038, 0.553],
	[-0.013, -0.802, -0.011, 0.598],
	[-0.053, -0.776, -0.037, 0.627],
	[-0.137, -0.718, -0.126, 0.671],
	[-0.672, -0.147, -0.710, 0.152],
	[-0.626, -0.233, -0.699, 0.255],
	[-0.597, -0.263, -0.698, 0.296],
	[-0.537, -0.292, -0.713, 0.344],
	[-0.513, -0.329, -0.694, 0.383],
	[-0.470, -0.367, -0.679, 0.429],
	[-0.083, -0.802, -0.125, 0.578],
	[-0.588, 0.120, -0.796, 0.084],
	[-0.530, 0.310, -0.706, 0.353],
	[-0.507, 0.334, -0.689, 0.396],
	[-0.465, 0.354, -0.685, 0.435],
	[-0.422, 0.354, -0.701, 0.453],
	[-0.333, 0.404, -0.645, 0.556],
	[-0.216, 0.479, -0.483, 0.701],
	[0.552, -0.078, 0.830, 0.018],
	[0.562, -0.164, 0.755, 0.295],
	[0.556, -0.068, 0.806, 0.193],
	[0.547, -0.272, 0.683, 0.400],
	[0.467, -0.423, 0.561, 0.537],
	[0.492, -0.394, 0.586, 0.510],
	[0.534, -0.488, 0.510, 0.465],
	[0.561, -0.478, 0.518, 0.434],
	[0.559, -0.500, 0.493, 0.441],
	[0.580, -0.501, 0.490, 0.415],
	[0.528, -0.490, 0.508, 0.473],
	[0.543, -0.492, 0.506, 0.455],
	[0.420, -0.452, 0.530, 0.582],
	[0.452, -0.416, 0.567, 0.549],
	[0.463, -0.407, 0.581, 0.531],
	[0.438, -0.396, 0.588, 0.553],
	[0.458, -0.404, 0.586, 0.532],
	[0.438, -0.454, 0.544, 0.553],
	[0.475, -0.494, 0.505, 0.524],
	[0.481, -0.476, 0.521, 0.520],
	[0.533, -0.520, 0.478, 0.465],
	[0.530, -0.522, 0.476, 0.469],
	[0.542, -0.523, 0.474, 0.456],
	[0.563, -0.540, 0.458, 0.426],
	[0.537, -0.540, 0.458, 0.459],
	[0.534, -0.532, 0.465, 0.465],
	[0.557, -0.531, 0.468, 0.434],
	[0.535, -0.541, 0.461, 0.458],
	[0.520, -0.556, 0.441, 0.475],
	[0.523, -0.575, 0.424, 0.464],
	[0.495, -0.629, 0.338, 0.496],
	[0.504, -0.627, 0.342, 0.486],
	[0.498, -0.654, 0.302, 0.483],
	[0.519, -0.681, 0.265, 0.445],
	[0.536, -0.703, 0.235, 0.404],
	[0.515, -0.724, 0.212, 0.407],
	[0.503, -0.706, 0.254, 0.429],
	[0.478, -0.686, 0.293, 0.464],
	[0.469, -0.655, 0.329, 0.494],
	[0.471, -0.639, 0.337, 0.506],
	[0.459, -0.598, 0.392, 0.528],
	[0.465, -0.454, 0.557, 0.517],
	[0.426, -0.454, 0.561, 0.546],
	[0.456, -0.447, 0.567, 0.521],
	[0.434, -0.629, 0.350, 0.541],
	[0.456, -0.616, 0.374, 0.522],
	[0.471, -0.637, 0.356, 0.496],
	[0.428, -0.673, 0.324, 0.509],
	[0.408, -0.690, 0.312, 0.511],
	[0.414, -0.703, 0.323, 0.479],
	[0.386, -0.674, 0.330, 0.536],
	[0.622, -0.255, 0.682, 0.287],
	[0.600, -0.212, 0.722, 0.271],
	[0.598, -0.212, 0.724, 0.271],
	[0.604, -0.213, 0.719, 0.268],
	[0.618, -0.225, 0.705, 0.266],
	[0.620, -0.156, 0.739, 0.213],
	[0.376, -0.692, 0.328, 0.522],
	[0.402, -0.691, 0.344, 0.492],
	[0.421, -0.690, 0.362, 0.464],
	[0.436, -0.687, 0.374, 0.445],
	[0.414, -0.701, 0.361, 0.455],
	[0.588, -0.041, 0.794, 0.150],
	[0.589, -0.094, 0.801, 0.047],
	[0.126, -0.759, 0.127, 0.627],
	[0.673, -0.014, 0.739, 0.023],
	[0.684, -0.094, 0.717, 0.097],
	[0.670, -0.093, 0.730, 0.096],
	[0.672, -0.087, 0.730, 0.090],
	[0.075, -0.755, 0.068, 0.647],
	[0.119, -0.779, 0.111, 0.606],
	[0.093, -0.790, 0.082, 0.600],
	[0.104, -0.800, 0.096, 0.583],
	[0.090, -0.763, 0.086, 0.635],
	[0.084, -0.737, 0.082, 0.665],
	[0.652, -0.024, 0.758, 0.013],
	[0.619, -0.041, 0.783, 0.031],
	[0.630, -0.031, 0.776, 0.022],
	[-0.659, 0.035, -0.751, 0.031],
	[-0.050, 0.752, -0.055, 0.655],
	[-0.091, 0.761, -0.096, 0.635],
	[-0.106, 0.795, -0.117, 0.586],
	[-0.093, 0.791, -0.099, 0.596],
	[-0.066, 0.757, -0.069, 0.646],
	[-0.662, 0.038, -0.747, 0.032],
	[-0.668, 0.043, -0.741, 0.041],
	[-0.637, 0.058, -0.767, 0.053],
	[-0.610, 0.070, -0.786, 0.066],
	[-0.601, 0.078, -0.792, 0.073],
	[-0.625, 0.072, -0.774, 0.070],
	[-0.618, 0.088, -0.777, 0.085],
	[-0.630, 0.087, -0.766, 0.087],
	[-0.618, 0.107, -0.771, 0.109],
	[-0.630, -0.110, -0.760, 0.116],
	[-0.640, -0.106, -0.754, 0.109],
	[-0.648, -0.089, -0.750, 0.093],
	[-0.646, -0.088, -0.753, 0.092],
	[-0.654, -0.084, -0.747, 0.086],
	[-0.654, -0.091, -0.746, 0.092],
	[-0.658, -0.081, -0.744, 0.083],
	[-0.659, -0.082, -0.743, 0.085],
	[-0.668, -0.076, -0.736, 0.078],
	[-0.669, -0.069, -0.737, 0.071],
	[-0.665, -0.069, -0.740, 0.071],
	[-0.664, -0.067, -0.741, 0.070],
]

// 6
const rightLandscapeQuaternions = [
	[-0.057, 0.638, 0.076, 0.764],
	[-0.040, 0.654, 0.050, 0.754],
	[-0.049, 0.640, 0.065, 0.764],
	[-0.076, 0.628, 0.102, 0.768],
	[-0.025, 0.691, 0.027, 0.722],
	[-0.030, 0.656, 0.039, 0.753],
	[-0.074, 0.663, 0.087, 0.740],
	[-0.170, 0.644, 0.194, 0.720],
	[-0.185, 0.644, 0.209, 0.712],
	[-0.197, 0.636, 0.229, 0.710],
	[-0.223, 0.624, 0.260, 0.702],
	[-0.219, 0.636, 0.247, 0.698],
	[-0.187, 0.636, 0.219, 0.716],
	[-0.183, 0.619, 0.222, 0.731],
	[-0.187, 0.637, 0.209, 0.718],
	[-0.205, 0.581, 0.251, 0.747],
	[-0.188, 0.599, 0.219, 0.747],
	[-0.241, 0.585, 0.278, 0.722],
	[-0.270, 0.601, 0.299, 0.691],
	[-0.269, 0.608, 0.295, 0.686],
	[-0.705, 0.271, 0.614, 0.228],
	[-0.665, 0.310, 0.616, 0.288],
	[-0.696, 0.328, 0.567, 0.292],
	[-0.131, 0.604, 0.213, 0.756],
	[-0.679, 0.348, 0.567, 0.311],
	[-0.149, 0.629, 0.195, 0.737],
	[-0.187, 0.628, 0.224, 0.721],
	[-0.160, 0.619, 0.192, 0.744],
	[-0.112, 0.650, 0.125, 0.741],
	[-0.225, 0.558, 0.291, 0.744],
	[-0.275, 0.547, 0.341, 0.714],
	[-0.321, 0.595, 0.346, 0.651],
	[-0.673, 0.324, 0.600, 0.286],
	[-0.629, 0.366, 0.592, 0.346],
	[-0.611, 0.415, 0.555, 0.383],
	[-0.685, 0.380, 0.537, 0.313],
	[-0.694, 0.358, 0.545, 0.305],
	[-0.693, 0.307, 0.590, 0.278],
	[-0.179, 0.606, 0.241, 0.737],
	[-0.257, 0.621, 0.284, 0.683],
	[-0.261, 0.587, 0.310, 0.701],
	[-0.300, 0.583, 0.344, 0.672],
	[-0.360, 0.561, 0.400, 0.629],
	[-0.657, 0.363, 0.582, 0.312],
	[-0.628, 0.440, 0.531, 0.361],
	[-0.618, 0.509, 0.466, 0.377],
	[-0.629, 0.517, 0.450, 0.367],
	[-0.603, 0.515, 0.460, 0.399],
	[-0.578, 0.545, 0.426, 0.432],
	[-0.595, 0.504, 0.468, 0.415],
	[-0.642, 0.425, 0.525, 0.362],
	[-0.280, 0.614, 0.312, 0.669],
	[-0.291, 0.591, 0.334, 0.674],
	[-0.321, 0.543, 0.394, 0.668],
	[-0.351, 0.554, 0.405, 0.637],
	[-0.417, 0.504, 0.477, 0.586],
	[-0.466, 0.503, 0.492, 0.537],
	[-0.476, 0.483, 0.513, 0.527],
	[-0.582, 0.489, 0.505, 0.409],
	[-0.589, 0.538, 0.451, 0.401],
	[-0.557, 0.565, 0.417, 0.443],
	[-0.566, 0.564, 0.414, 0.436],
	[-0.547, 0.525, 0.463, 0.459],
	[-0.532, 0.532, 0.458, 0.473],
	[-0.427, 0.509, 0.483, 0.570],
	[-0.427, 0.474, 0.520, 0.569],
	[-0.479, 0.452, 0.541, 0.523],
	[-0.495, 0.441, 0.552, 0.507],
	[-0.487, 0.406, 0.577, 0.514],
	[-0.494, 0.440, 0.555, 0.505],
	[-0.490, 0.534, 0.465, 0.508],
	[-0.481, 0.548, 0.450, 0.516],
	[-0.445, 0.481, 0.523, 0.545],
	[-0.430, 0.483, 0.522, 0.557],
	[-0.407, 0.449, 0.553, 0.571],
	[-0.406, 0.436, 0.569, 0.566],
	[-0.469, 0.408, 0.592, 0.514],
	[-0.486, 0.395, 0.603, 0.495],
	[-0.508, 0.369, 0.622, 0.468],
	[-0.524, 0.359, 0.626, 0.452],
	[-0.466, 0.574, 0.429, 0.520],
	[-0.448, 0.596, 0.400, 0.533],
	[-0.447, 0.598, 0.397, 0.534],
	[-0.416, 0.614, 0.371, 0.559],
	[-0.399, 0.622, 0.359, 0.570],
	[-0.528, 0.386, 0.614, 0.442],
	[-0.554, 0.307, 0.677, 0.374],
	[-0.568, 0.257, 0.707, 0.334],
	[-0.579, 0.229, 0.716, 0.315],
	[-0.403, 0.671, 0.350, 0.514],
	[-0.398, 0.687, 0.340, 0.505],
	[-0.394, 0.680, 0.335, 0.520],
	[-0.364, 0.660, 0.326, 0.571],
	[-0.618, 0.308, 0.647, 0.323],
	[-0.602, 0.297, 0.664, 0.330],
	[-0.599, 0.282, 0.678, 0.321],
	[-0.562, 0.271, 0.706, 0.335],
	[-0.569, 0.243, 0.720, 0.314],
	[-0.602, 0.251, 0.697, 0.298],
	[-0.605, 0.254, 0.692, 0.301],
	[-0.342, 0.658, 0.315, 0.593],
	[-0.356, 0.675, 0.312, 0.566],
	[-0.330, 0.671, 0.299, 0.593],
	[-0.614, 0.249, 0.691, 0.289],
	[-0.605, 0.271, 0.682, 0.309],
	[-0.586, 0.249, 0.707, 0.307],
	[-0.588, 0.226, 0.722, 0.286],
	[-0.536, 0.214, 0.757, 0.307],
	[-0.538, 0.216, 0.753, 0.310],
	[-0.566, 0.238, 0.729, 0.302],
	[-0.539, 0.262, 0.730, 0.329],
	[-0.562, 0.258, 0.722, 0.311],
	[-0.541, 0.249, 0.741, 0.309],
	[-0.584, 0.244, 0.718, 0.290],
	[-0.627, 0.212, 0.708, 0.245],
	[-0.625, 0.170, 0.730, 0.218],
	[-0.631, 0.189, 0.717, 0.228],
	[-0.602, 0.210, 0.726, 0.259],
	[-0.620, 0.233, 0.703, 0.259],
	[-0.519, 0.277, 0.740, 0.327],
	[-0.528, 0.261, 0.743, 0.317],
	[-0.550, 0.262, 0.732, 0.305],
	[-0.570, 0.183, 0.763, 0.244],
	[-0.576, 0.143, 0.779, 0.204],
	[-0.582, 0.113, 0.783, 0.187],
	[-0.573, 0.067, 0.797, 0.180],
	[-0.589, 0.127, 0.769, 0.212],
	[-0.626, 0.171, 0.731, 0.212],
	[-0.632, 0.187, 0.720, 0.216],
	[-0.637, 0.206, 0.708, 0.225],
	[-0.586, 0.149, 0.773, 0.192],
	[-0.528, 0.115, 0.825, 0.166],
	[-0.563, 0.057, 0.821, 0.078],
	[-0.603, 0.050, 0.794, 0.062],
	[-0.619, 0.124, 0.763, 0.137],
	[-0.630, 0.156, 0.742, 0.169],
	[-0.663, 0.084, 0.739, 0.087],
	[-0.575, 0.101, 0.803, 0.119],
	[-0.555, 0.088, 0.821, 0.096],
	[-0.496, 0.055, 0.864, 0.073],
	[-0.463, 0.054, 0.881, 0.078],
	[-0.465, 0.019, 0.883, 0.056],
	[-0.491, 0.027, 0.870, 0.029],
	[-0.534, 0.007, 0.845, 0.038],
	[-0.563, 0.051, 0.822, 0.066],
	[-0.564, 0.076, 0.818, 0.083],
	[-0.571, 0.119, 0.803, 0.121],
	[-0.604, 0.162, 0.761, 0.174],
	[-0.622, 0.162, 0.745, 0.178],
	[-0.691, 0.128, 0.700, 0.131],
	[-0.125, 0.732, 0.115, 0.659],
	[-0.108, 0.734, 0.099, 0.663],
	[-0.077, 0.761, 0.055, 0.641],
	[-0.018, 0.772, 0.007, 0.635],
	[-0.015, 0.792, 0.047, 0.608],
	[-0.035, 0.806, 0.069, 0.587],
	[-0.008, 0.794, 0.017, 0.608],
	[-0.054, 0.748, 0.046, 0.660],
	[-0.696, 0.077, 0.710, 0.078],
	[-0.645, 0.128, 0.741, 0.133],
	[-0.645, 0.098, 0.751, 0.102],
	[-0.571, 0.094, 0.808, 0.109],
	[-0.580, 0.015, 0.813, 0.048],
	[-0.572, 0.003, 0.820, 0.034],
	[-0.520, 0.024, 0.853, 0.035],
	[-0.507, 0.002, 0.860, 0.051],
	[-0.516, 0.049, 0.852, 0.071],
	[-0.563, 0.102, 0.814, 0.098],
	[-0.619, 0.085, 0.777, 0.082],
	[-0.639, -0.077, 0.762, 0.077],
	[-0.611, -0.061, 0.786, 0.071],
	[-0.623, 0.046, 0.779, 0.052],
	[-0.653, 0.017, 0.757, 0.024],
	[-0.669, 0.018, 0.743, 0.013],
	[-0.636, 0.040, 0.770, 0.027],
	[0.622, -0.031, -0.782, 0.017],
	[0.569, -0.005, -0.822, 0.012],
	[0.586, -0.030, -0.810, 0.019],
	[0.506, 0.043, -0.861, 0.020],
	[0.588, 0.008, -0.809, 0.003],
	[0.628, 0.018, -0.778, 0.017],
	[0.683, 0.002, -0.730, 0.004],
	[0.073, 0.749, -0.075, 0.654],
	[0.082, 0.758, -0.088, 0.641],
	[0.104, 0.751, -0.104, 0.644],
	[0.068, 0.725, -0.066, 0.683],
	[0.038, 0.720, -0.037, 0.692],
	[0.001, 0.759, -0.013, 0.651],
	[0.020, 0.745, -0.012, 0.667],
	[0.058, 0.760, -0.053, 0.645],
	[0.047, 0.749, -0.046, 0.659],
	[0.052, 0.747, -0.050, 0.661],
	[0.103, 0.754, -0.102, 0.640],
	[0.095, 0.732, -0.092, 0.668],
	[0.138, 0.728, -0.131, 0.659],
	[0.143, 0.693, -0.144, 0.692],
	[0.661, 0.169, -0.709, 0.177],
	[0.668, 0.081, -0.735, 0.085],
	[0.637, 0.067, -0.764, 0.077],
	[0.591, 0.073, -0.798, 0.092],
	[0.603, 0.035, -0.795, 0.058],
	[0.566, 0.017, -0.823, 0.048],
	[0.583, 0.009, -0.812, 0.027],
	[0.575, 0.002, -0.818, 0.032],
	[0.590, 0.074, -0.797, 0.106],
	[0.576, 0.093, -0.802, 0.127],
	[0.584, 0.124, -0.787, 0.156],
	[0.558, 0.108, -0.809, 0.150],
	[0.629, 0.125, -0.751, 0.156],
	[0.649, 0.103, -0.743, 0.127],
	[0.658, 0.145, -0.720, 0.164],
	[0.247, 0.683, -0.235, 0.645],
	[0.243, 0.706, -0.218, 0.628],
	[0.226, 0.703, -0.203, 0.643],
	[0.234, 0.699, -0.214, 0.641],
	[0.278, 0.684, -0.259, 0.623],
	[0.621, 0.147, -0.744, 0.198],
	[0.647, 0.163, -0.720, 0.190],
	[0.651, 0.210, -0.694, 0.225],
	[0.621, 0.216, -0.712, 0.245],
	[0.556, 0.231, -0.744, 0.290],
	[0.499, 0.272, -0.751, 0.335],
	[0.558, 0.217, -0.747, 0.288],
	[0.587, 0.151, -0.762, 0.229],
	[0.567, 0.108, -0.789, 0.210],
	[0.546, 0.106, -0.801, 0.222],
	[0.542, 0.152, -0.787, 0.253],
	[0.468, 0.178, -0.811, 0.302],
	[0.401, 0.248, -0.807, 0.357],
	[0.430, 0.257, -0.786, 0.362],
	[0.467, 0.232, -0.782, 0.342],
	[0.524, 0.229, -0.756, 0.320],
	[0.564, 0.213, -0.742, 0.292],
	[0.584, 0.149, -0.761, 0.239],
	[0.627, 0.194, -0.717, 0.234],
	[0.645, 0.201, -0.702, 0.224],
	[0.632, 0.270, -0.669, 0.283],
	[0.269, 0.664, -0.262, 0.647],
	[0.313, 0.680, -0.283, 0.600],
	[0.318, 0.694, -0.275, 0.584],
	[0.329, 0.708, -0.275, 0.561],
	[0.300, 0.711, -0.251, 0.584],
	[0.250, 0.706, -0.213, 0.628],
	[0.279, 0.720, -0.216, 0.598],
	[0.297, 0.693, -0.255, 0.605],
	[0.328, 0.678, -0.295, 0.588],
	[0.319, 0.690, -0.287, 0.584],
	[0.388, 0.662, -0.343, 0.542],
	[0.609, 0.177, -0.735, 0.242],
	[0.587, 0.260, -0.698, 0.317],
	[0.570, 0.335, -0.645, 0.383],
	[0.582, 0.310, -0.657, 0.365],
	[0.517, 0.597, -0.432, 0.435],
	[0.584, 0.157, -0.750, 0.269],
	[0.614, 0.209, -0.713, 0.265],
	[0.579, 0.290, -0.678, 0.347],
	[0.508, 0.410, -0.596, 0.467],
	[0.534, 0.453, -0.545, 0.462],
	[0.507, 0.567, -0.436, 0.481],
	[0.529, 0.584, -0.419, 0.451],
	[0.516, 0.598, -0.403, 0.463],
	[0.511, 0.631, -0.351, 0.466],
	[0.512, 0.612, -0.377, 0.469],
	[0.544, 0.581, -0.423, 0.432],
	[0.561, 0.579, -0.429, 0.408],
	[0.532, 0.579, -0.425, 0.448],
	[0.495, 0.546, -0.455, 0.501],
	[0.500, 0.515, -0.486, 0.498],
	[0.498, 0.428, -0.566, 0.498],
	[0.488, 0.410, -0.578, 0.509],
	[0.484, 0.382, -0.600, 0.510],
	[0.470, 0.412, -0.579, 0.524],
	[0.431, 0.457, -0.538, 0.562],
	[0.412, 0.447, -0.544, 0.579],
	[0.441, 0.477, -0.517, 0.558],
	[0.444, 0.437, -0.547, 0.558],
	[0.457, 0.420, -0.559, 0.550],
	[0.467, 0.396, -0.577, 0.541],
	[0.420, 0.449, -0.529, 0.586],
	[0.280, 0.538, -0.377, 0.700],
	[0.259, 0.529, -0.356, 0.725],
	[0.276, 0.528, -0.364, 0.716],
	[0.301, 0.515, -0.374, 0.710],
	[0.323, 0.501, -0.392, 0.701],
	[0.328, 0.501, -0.390, 0.700],
	[0.307, 0.558, -0.350, 0.686],
	[0.265, 0.607, -0.289, 0.692],
	[0.681, 0.303, -0.610, 0.270],
	[0.687, 0.315, -0.595, 0.275],
	[0.696, 0.288, -0.608, 0.250],
	[0.727, 0.301, -0.576, 0.222],
	[0.733, 0.322, -0.558, 0.219],
	[0.717, 0.372, -0.533, 0.253],
	[0.678, 0.328, -0.591, 0.288],
	[0.718, 0.341, -0.544, 0.271],
	[0.719, 0.310, -0.573, 0.243],
	[0.721, 0.299, -0.584, 0.225],
	[0.711, 0.309, -0.584, 0.240],
	[0.712, 0.314, -0.580, 0.243],
	[0.705, 0.326, -0.573, 0.261],
	[0.686, 0.310, -0.601, 0.269],
	[0.699, 0.344, -0.560, 0.281],
	[0.721, 0.318, -0.569, 0.234],
	[0.683, 0.360, -0.567, 0.287],
	[0.692, 0.326, -0.585, 0.268],
	[0.719, 0.339, -0.553, 0.250],
	[0.700, 0.314, -0.586, 0.261],
	[0.721, 0.323, -0.563, 0.242],
	[0.703, 0.312, -0.586, 0.255],
	[0.710, 0.319, -0.574, 0.256],
	[0.721, 0.333, -0.554, 0.250],
	[0.725, 0.341, -0.547, 0.242],
	[0.709, 0.328, -0.570, 0.254],
	[0.714, 0.325, -0.568, 0.250],
	[0.718, 0.335, -0.556, 0.252],
]

// 3
const upsideDownQuaternions = [
	[-0.590, 0.068, -0.075, 0.801],
	[-0.625, 0.057, -0.152, 0.763],
	[-0.601, 0.050, -0.192, 0.774],
	[-0.631, 0.091, -0.188, 0.747],
	[-0.659, 0.045, -0.143, 0.737],
	[-0.663, 0.028, -0.116, 0.739],
	[-0.669, 0.061, -0.106, 0.733],
	[-0.639, 0.112, -0.087, 0.756],
	[-0.649, 0.144, -0.062, 0.744],
	[-0.615, 0.180, -0.041, 0.767],
	[-0.559, 0.213, -0.005, 0.801],
	[-0.549, 0.274, -0.064, 0.787],
	[-0.538, 0.258, -0.083, 0.799],
	[-0.579, 0.228, -0.116, 0.774],
	[-0.554, 0.163, -0.019, 0.816],
	[-0.573, 0.082, -0.047, 0.814],
	[-0.605, 0.056, -0.092, 0.789],
	[-0.598, 0.008, -0.108, 0.794],
	[-0.628, 0.104, -0.155, 0.755],
	[-0.624, 0.161, -0.190, 0.741],
	[-0.640, 0.094, -0.204, 0.735],
	[-0.644, 0.013, -0.108, 0.757],
	[-0.661, 0.018, -0.067, 0.747],
	[-0.605, 0.109, -0.048, 0.787],
	[-0.590, 0.133, -0.004, 0.797],
	[-0.559, 0.198, 0.045, 0.804],
	[-0.534, 0.224, 0.125, 0.805],
	[-0.535, 0.237, 0.118, 0.802],
	[-0.523, 0.175, 0.146, 0.822],
	[-0.544, 0.112, 0.069, 0.829],
	[-0.540, 0.023, 0.058, 0.839],
	[-0.598, 0.003, 0.039, 0.800],
	[-0.550, -0.001, 0.006, 0.835],
	[-0.618, -0.043, 0.023, 0.785],
	[-0.601, -0.012, 0.015, 0.799],
	[-0.639, -0.018, 0.016, 0.769],
	[-0.596, -0.062, 0.033, 0.800],
	[-0.647, -0.147, 0.145, 0.734],
	[-0.564, -0.237, 0.235, 0.755],
	[-0.512, -0.292, 0.247, 0.769],
	[-0.504, -0.320, 0.282, 0.751],
	[-0.520, -0.272, 0.341, 0.734],
	[-0.506, -0.280, 0.341, 0.741],
	[-0.495, -0.239, 0.370, 0.749],
	[-0.547, -0.196, 0.374, 0.723],
	[-0.566, -0.208, 0.359, 0.713],
	[-0.550, -0.208, 0.323, 0.742],
	[-0.573, -0.190, 0.329, 0.726],
	[-0.590, -0.214, 0.332, 0.704],
	[-0.550, -0.266, 0.341, 0.714],
	[-0.538, -0.286, 0.353, 0.710],
	[-0.505, -0.269, 0.410, 0.710],
	[-0.472, -0.401, 0.527, 0.582],
	[-0.473, -0.413, 0.544, 0.556],
	[-0.458, -0.322, 0.596, 0.576],
	[-0.483, -0.359, 0.579, 0.550],
	[-0.511, -0.343, 0.574, 0.540],
	[-0.583, -0.242, 0.436, 0.641],
	[-0.606, -0.255, 0.477, 0.584],
	[-0.605, -0.425, 0.516, 0.433],
	[-0.576, -0.497, 0.580, 0.292],
	[-0.520, -0.591, 0.568, 0.241],
	[-0.451, -0.659, 0.580, 0.157],
	[-0.504, -0.619, 0.565, 0.209],
	[-0.434, -0.679, 0.575, 0.143],
	[-0.427, -0.676, 0.583, 0.144],
	[-0.449, -0.670, 0.558, 0.194],
	[-0.417, -0.641, 0.576, 0.288],
	[-0.443, -0.620, 0.546, 0.349],
	[-0.443, -0.628, 0.524, 0.367],
	[-0.402, -0.648, 0.540, 0.357],
	[-0.353, -0.644, 0.561, 0.382],
	[-0.297, -0.654, 0.600, 0.353],
	[-0.252, -0.635, 0.651, 0.331],
	[-0.213, -0.617, 0.683, 0.329],
	[-0.216, -0.616, 0.695, 0.300],
	[-0.242, -0.605, 0.701, 0.290],
	[-0.293, -0.615, 0.683, 0.264],
	[-0.323, -0.589, 0.679, 0.297],
	[-0.316, -0.612, 0.656, 0.307],
	[-0.360, -0.608, 0.610, 0.360],
	[-0.417, -0.590, 0.568, 0.394],
	[-0.479, -0.593, 0.532, 0.370],
	[-0.479, -0.607, 0.506, 0.382],
	[-0.475, -0.595, 0.481, 0.435],
	[-0.444, -0.642, 0.490, 0.389],
	[-0.375, -0.645, 0.542, 0.388],
	[-0.312, -0.661, 0.590, 0.344],
	[-0.277, -0.662, 0.623, 0.312],
	[-0.255, -0.654, 0.657, 0.276],
	[-0.246, -0.673, 0.657, 0.234],
	[-0.250, -0.701, 0.640, 0.193],
	[-0.210, -0.719, 0.642, 0.164],
	[-0.205, -0.761, 0.603, 0.123],
	[-0.218, -0.771, 0.584, 0.126],
	[-0.262, -0.760, 0.563, 0.195],
	[-0.286, -0.745, 0.551, 0.244],
	[-0.317, -0.752, 0.522, 0.250],
	[-0.285, -0.750, 0.533, 0.268],
	[-0.271, -0.740, 0.548, 0.282],
	[-0.227, -0.724, 0.576, 0.303],
	[-0.217, -0.707, 0.623, 0.256],
	[-0.104, -0.677, 0.712, 0.157],
	[-0.025, -0.661, 0.745, 0.084],
	[0.027, 0.645, -0.763, 0.034],
	[0.053, 0.655, -0.753, 0.018],
	[0.076, 0.690, -0.719, 0.017],
	[-0.105, 0.708, -0.698, 0.009],
	[-0.090, 0.714, -0.693, 0.033],
	[-0.098, 0.751, -0.649, 0.073],
	[-0.151, 0.763, -0.628, 0.035],
	[-0.083, 0.767, -0.636, 0.005],
	[-0.055, 0.780, -0.622, 0.042],
	[-0.014, 0.789, -0.605, 0.105],
	[-0.104, 0.792, -0.585, 0.143],
	[-0.006, 0.794, -0.596, 0.121],
	[-0.016, 0.766, -0.638, 0.073],
	[-0.066, 0.791, -0.607, 0.040],
	[-0.129, 0.707, -0.682, 0.135],
	[-0.240, 0.696, -0.624, 0.261],
	[-0.301, 0.703, -0.574, 0.292],
	[-0.353, 0.723, -0.522, 0.284],
	[-0.455, 0.660, -0.487, 0.346],
	[-0.531, 0.623, -0.432, 0.379],
	[-0.558, 0.580, -0.472, 0.361],
	[-0.552, 0.603, -0.476, 0.324],
	[-0.450, 0.659, -0.541, 0.266],
	[-0.400, 0.676, -0.599, 0.155],
	[-0.284, 0.707, -0.644, 0.074],
	[-0.313, 0.606, -0.712, 0.167],
	[-0.313, 0.585, -0.729, 0.166],
	[-0.400, 0.503, -0.694, 0.324],
	[-0.442, 0.457, -0.599, 0.487],
	[-0.437, 0.503, -0.551, 0.503],
	[-0.437, 0.507, -0.530, 0.520],
	[-0.435, 0.518, -0.493, 0.548],
	[-0.488, 0.538, -0.435, 0.533],
	[-0.543, 0.499, -0.407, 0.538],
	[-0.607, 0.444, -0.362, 0.551],
	[-0.652, 0.379, -0.320, 0.574],
	[-0.689, 0.314, -0.322, 0.568],
	[-0.704, 0.270, -0.331, 0.567],
	[-0.718, 0.237, -0.372, 0.539],
	[-0.698, 0.247, -0.377, 0.556],
	[-0.713, 0.196, -0.367, 0.564],
	[-0.660, 0.113, -0.277, 0.689],
	[-0.657, 0.160, -0.279, 0.681],
	[-0.651, 0.226, -0.291, 0.663],
	[-0.649, 0.266, -0.289, 0.651],
	[-0.650, 0.286, -0.299, 0.637],
	[-0.649, 0.292, -0.283, 0.643],
	[-0.661, 0.278, -0.275, 0.640],
	[-0.683, 0.269, -0.279, 0.620],
	[-0.686, 0.255, -0.268, 0.627],
	[-0.706, 0.256, -0.227, 0.620],
	[-0.732, 0.235, -0.228, 0.598],
	[-0.745, 0.229, -0.199, 0.595],
	[-0.771, 0.194, -0.237, 0.559],
	[-0.766, 0.168, -0.190, 0.591],
	[-0.768, 0.107, -0.140, 0.616],
	[-0.745, 0.089, -0.154, 0.643],
	[-0.713, 0.065, -0.111, 0.690],
	[-0.680, 0.049, -0.073, 0.728],
	[-0.629, 0.109, -0.110, 0.762],
	[-0.591, 0.207, -0.218, 0.748],
	[-0.576, 0.250, -0.233, 0.743],
	[-0.551, 0.280, -0.232, 0.751],
	[-0.543, 0.296, -0.244, 0.747],
	[-0.540, 0.336, -0.229, 0.737],
	[-0.566, 0.326, -0.222, 0.724],
	[-0.620, 0.317, -0.209, 0.687],
	[-0.700, 0.286, -0.140, 0.639],
	[-0.737, 0.192, -0.044, 0.647],
	[-0.746, 0.148, -0.061, 0.646],
	[-0.774, 0.124, -0.015, 0.621],
	[-0.743, 0.095, -0.008, 0.663],
	[-0.780, 0.122, -0.037, 0.612],
	[-0.724, 0.094, -0.027, 0.683],
	[-0.751, 0.103, -0.019, 0.652],
	[-0.736, 0.107, -0.013, 0.668],
	[-0.742, 0.107, -0.016, 0.662],
	[-0.730, 0.084, -0.036, 0.678],
	[-0.739, 0.105, -0.038, 0.665],
	[-0.740, 0.096, -0.027, 0.665],
	[-0.752, 0.095, -0.025, 0.652],
	[-0.732, 0.094, -0.028, 0.674],
	[-0.734, 0.090, -0.032, 0.672],
	[-0.728, 0.078, -0.041, 0.680],
	[-0.747, 0.089, -0.018, 0.658],
	[-0.743, 0.079, -0.044, 0.663],
	[-0.735, 0.095, -0.028, 0.671],
	[-0.729, 0.089, -0.019, 0.679],
	[-0.755, 0.082, -0.037, 0.649],
	[-0.726, 0.090, -0.026, 0.681],
	[-0.731, 0.096, -0.023, 0.675],
	[-0.739, 0.084, -0.016, 0.668],
	[-0.748, 0.089, -0.014, 0.657],
	[-0.740, 0.084, -0.029, 0.667],
	[-0.731, 0.091, -0.022, 0.676],
	[-0.731, 0.083, -0.026, 0.677],
]

// Unit tests for quaternion-based orientation detection
import {describe, test, expect} from 'vitest';
import Quaternion from "quaternion";

const uprightCorrection = new Quaternion({
	w: Math.cos(Math.PI / 4),
	x: Math.sin(Math.PI / 4),
	y: 0,
	z: 0
});

function testGravityVector(quaternionArray: number[], gravityVector: number[]): number | string {
	const [x, y, z, w] = quaternionArray;
	const q_device = new Quaternion(w, x, y, z);
	// Test without upright correction
	const g = q_device.rotateVector(gravityVector);

	const absX = Math.abs(g[0]);
	const absY = Math.abs(g[1]);
	const absZ = Math.abs(g[2]);

	// Portrait/upside-down: gravity primarily affects Y-axis
	if (absY > absX && absY > absZ) {
		return g[1] > 0 ? 1 : 3;   // upright or upside-down
	}
	// Landscape: gravity primarily affects X-axis
	else if (absX > absY && absX > absZ) {
		return g[0] > 0 ? 6 : 8;   // rotate clockwise or counter-clockwise
	}
	// Z-axis dominant
	else {
		return g[2] > 0 ? 'Z+' : 'Z-';
	}
}

function testRotationMatrix(quaternionArray: number[]): number | string {
	const [x, y, z, w] = quaternionArray;
	const q = new Quaternion(w, x, y, z);

	// Get rotation matrix
	const matrix = q.toMatrix();
	// Matrix layout: [r11, r12, r13, r21, r22, r23, r31, r32, r33]
	//                [ 0,   1,   2,   3,   4,   5,   6,   7,   8 ]

	// Try different approaches to extract orientation
	// Approach 1: Look at r11, r12, r21, r22 (top-left 2x2 for screen rotation)
	const r11 = matrix[0];
	const r12 = matrix[1];
	const r21 = matrix[3];
	const r22 = matrix[4];

	// Screen rotation angle
	const screenAngle = Math.atan2(r21, r11) * (180 / Math.PI);
	const normalizedAngle = ((screenAngle % 360) + 360) % 360;

	if (normalizedAngle < 45 || normalizedAngle >= 315) {
		return 1;   // Portrait
	} else if (normalizedAngle >= 45 && normalizedAngle < 135) {
		return 6;   // Landscape right
	} else if (normalizedAngle >= 135 && normalizedAngle < 225) {
		return 3;   // Upside-down
	} else {
		return 8;   // Landscape left
	}
}

function testOrientationAccuracy(quaternions: number[][], expectedExif: number, orientationName: string, gravityVector: number[]): number {
	const results = quaternions.map(q => testGravityVector(q, gravityVector));
	const correctCount = results.filter(result => result === expectedExif).length;
	const accuracy = correctCount / quaternions.length;
	console.log(`EXIF ${expectedExif} with gravity [${gravityVector.join(',')}]: ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);
	return accuracy;
}

function quatToEuler(q: number[]) {
	const [x, y, z, w] = q; // AbsoluteOrientationSensor format: [x, y, z, w]

	// yaw (z-axis rotation)
	const ys = 2 * (w * z + x * y);
	const yc = 1 - 2 * (y * y + z * z);
	const yaw = Math.atan2(ys, yc);

	// pitch (x-axis rotation)
	const ps = 2 * (w * x - y * z);
	let pitch;
	if (Math.abs(ps) >= 1) {
		pitch = Math.sign(ps) * Math.PI / 2;
	} else {
		pitch = Math.asin(ps);
	}

	// roll (y-axis rotation)
	const rs = 2 * (w * y + x * z);
	const rc = 1 - 2 * (x * x + y * y);
	const roll = Math.atan2(rs, rc);

	return {yaw, pitch, roll};
}

function getOrientationFromEuler({pitch, roll}: { pitch: number, roll: number }) {
	const deg = (r: number) => r * 180 / Math.PI;

	const r = deg(roll);
	const p = deg(pitch);

	// Let's try using PITCH as the primary discriminator since both landscapes have roll ~90°
	// Normalize pitch to 0-360° range
	const normalizedPitch = ((p % 360) + 360) % 360;

	// Based on observed patterns with upright correction:
	// Portrait: roll ~±175°, pitch ~-6° (pitch ~354°)
	// Left landscape: roll ~90°, pitch ~53° OR pitch ~-45° (pitch ~315°)
	// Right landscape: roll ~93°, pitch ~79°
	// Upside down: should be in remaining quadrant

	// Pitch-based quadrant classification:
	if (normalizedPitch >= 315 || normalizedPitch < 45) {
		// 315° to 45° (around 0°/360°)
		// Portrait has pitch ~354° (-6°), Left landscape has pitch ~315° (-45°)
		if (Math.abs(r) > 150) {
			return 1; // Portrait: roll ~±175°
		} else {
			return 8; // Left landscape: roll ~90°, pitch ~315°
		}
	} else if (normalizedPitch >= 45 && normalizedPitch < 135) {
		// 45° to 135° (around 90°)
		// Right landscape has pitch ~79°, Left landscape has pitch ~53°
		if (r > 85 && r < 95) {
			// Both are in landscape roll range, need to distinguish
			if (p > 65) {
				return 6; // Right landscape
			} else {
				return 8; // Left landscape
			}
		}
		return 3; // Other cases might be upside-down
	} else if (normalizedPitch >= 135 && normalizedPitch < 225) {
		// 135° to 225° (around 180°)
		return 3; // Likely upside-down
	} else {
		// 225° to 315° (around 270°)
		return 3; // Upside-down fallback
	}
}

function testEulerApproach(quaternionArray: number[]): number {
	const euler = quatToEuler(quaternionArray);
	return getOrientationFromEuler(euler);
}

function testEulerWithUprightCorrection(quaternionArray: number[]): number {
	const [x, y, z, w] = quaternionArray;

	// Create quaternion from sensor data
	const q_device = new Quaternion(w, x, y, z);

	// Apply upright correction (90° rotation around X axis)
	const uprightCorrection = new Quaternion({
		w: Math.cos(Math.PI / 4),
		x: Math.sin(Math.PI / 4),
		y: 0,
		z: 0
	});

	const q_corrected = q_device.mul(uprightCorrection);

	// Convert corrected quaternion to Euler angles
	const correctedArray = [q_corrected.x, q_corrected.y, q_corrected.z, q_corrected.w];
	const euler = quatToEuler(correctedArray);

	return getOrientationFromEuler(euler);
}

function testHybridApproach(quaternionArray: number[]): number {
	const [x, y, z, w] = quaternionArray;

	// Balance between landscape detection and portrait/upside-down accuracy
	if (y < -0.3) {
		return 8; // Left landscape (balanced threshold)
	}
	if (y > 0.4) {
		return 6; // Right landscape (balanced threshold)
	}

	// For non-landscape cases, use the upright-corrected Euler approach
	const q_device = new Quaternion(w, x, y, z);
	const uprightCorrection = new Quaternion({
		w: Math.cos(Math.PI / 4),
		x: Math.sin(Math.PI / 4),
		y: 0,
		z: 0
	});
	const q_corrected = q_device.mul(uprightCorrection);
	const correctedArray = [q_corrected.x, q_corrected.y, q_corrected.z, q_corrected.w];
	const euler = quatToEuler(correctedArray);

	const deg = (r: number) => r * 180 / Math.PI;
	const r = deg(euler.roll);
	const normalizedRoll = ((r % 360) + 360) % 360;

	// Use the original quadrant logic that worked well
	if (normalizedRoll >= 315 || normalizedRoll < 45) {
		return 3; // Upside-down (around 0°)
	} else if (normalizedRoll >= 135 && normalizedRoll < 225) {
		return 1; // Portrait (around 180°)
	} else {
		return 3; // Upside-down
	}
}

function multiplyQuaternions(q1: { w: number, x: number, y: number, z: number }, q2: {
	w: number,
	x: number,
	y: number,
	z: number
}) {
	return {
		w: q1.w * q2.w - q1.x * q2.x - q1.y * q2.y - q1.z * q2.z,
		x: q1.w * q2.x + q1.x * q2.w + q1.y * q2.z - q1.z * q2.y,
		y: q1.w * q2.y - q1.x * q2.z + q1.y * q2.w + q1.z * q2.x,
		z: q1.w * q2.z + q1.x * q2.y - q1.y * q2.x + q1.z * q2.w
	};
}

function testReferenceQuaternionApproach(quaternionArray: number[]): number {
	const [x, y, z, w] = quaternionArray;

	// Use first straightUpright quaternion as reference (true baseline orientation)
	const q_reference = {w: 0.264, x: 0.294, y: 0.634, z: 0.665}; // First straightUpright sample

	// Current quaternion
	const q_current = {w, x, y, z};

	// Get inverse (conjugate) of reference quaternion
	const q_ref_inverse = {
		w: q_reference.w,
		x: -q_reference.x,
		y: -q_reference.y,
		z: -q_reference.z
	};

	// Calculate relative rotation: q_relative = q_ref_inverse * q_current
	const q_relative = multiplyQuaternions(q_ref_inverse, q_current);

	// Back to Z-axis rotation angle - try different reference or mapping
	let angle = Math.atan2(
		2 * (q_relative.w * q_relative.z + q_relative.x * q_relative.y),
		1 - 2 * (q_relative.y * q_relative.y + q_relative.z * q_relative.z)
	) * 180 / Math.PI;

	// Normalize to 0-360
	if (angle < 0) angle += 360;

	// Adjust angle ranges based on straightUpright reference results
	// Right landscape is 100%, left landscape is 92.8%, so the ranges work
	// But portrait and upside-down need better ranges
	if (angle >= 300 || angle < 60) return 1;      // Portrait (wider range)
	else if (angle >= 60 && angle < 120) return 8;  // Left landscape
	else if (angle >= 120 && angle < 240) return 3; // Upside down (wider range)
	else return 6;                                  // Right landscape
}

function testOptimalQuaternionApproach(quaternionArray: number[]): number {
	const [x, y, z, w] = quaternionArray;

	// Use straightUpright reference for landscape (which works excellently)
	const q_reference = {w: 0.264, x: 0.294, y: 0.634, z: 0.665}; // straightUpright reference
	const q_current = {w, x, y, z};
	const q_ref_inverse = { w: q_reference.w, x: -q_reference.x, y: -q_reference.y, z: -q_reference.z };
	const q_relative = multiplyQuaternions(q_ref_inverse, q_current);

	let angle = Math.atan2(
		2 * (q_relative.w * q_relative.z + q_relative.x * q_relative.y),
		1 - 2 * (q_relative.y * q_relative.y + q_relative.z * q_relative.z)
	) * 180 / Math.PI;

	if (angle < 0) angle += 360;

	// Use reference quaternion for landscapes (excellent results)
	if (angle >= 60 && angle < 120) return 8;  // Left landscape (92.3%)
	if (angle >= 240 && angle < 300) return 6; // Right landscape (100%)

	// For portrait/upside-down, fall back to the previous excellent upright Euler method
	return testEulerWithUprightCorrection(quaternionArray);
}

function testOptimalHybridApproach(quaternionArray: number[]): number {
	const [x, y, z, w] = quaternionArray;

	// Only use landscape detection for the most obvious cases
	if (y < -0.6) {
		return 8; // Left landscape (very strong signal)
	}
	if (y > 0.6) {
		return 6; // Right landscape (very strong signal)
	}

	// For everything else, use the original upright Euler approach that got 98.7%/100%
	return testEulerWithUprightCorrection(quaternionArray);
}

function testRawQuaternion(quaternionArray: number[]): number {
	const [x, y, z, w] = quaternionArray;

	// Strong negative y = left landscape
	if (y < -0.05) {
		return 8; // Left landscape
	}

	// Strong positive y = right landscape
	if (y > 0.15) {
		return 6; // Right landscape
	}

	// Upside-down: strong negative x
	if (x < -0.45) {
		return 3; // Upside-down
	}

	// Portrait: everything else
	return 1; // Portrait
}

function test() {
	const gravityVectors = [
		[0, -1, 0],   // -Y
		[0, 1, 0],    // +Y
		[0, 0, -1],   // -Z (down)
		[0, 0, 1],    // +Z (up)
		[-1, 0, 0],   // -X
		[1, 0, 0]     // +X
	];
	//
	// gravityVectors.forEach((gravityVector) => {
	// 	console.log(`\n=== Testing gravity vector [${gravityVector.join(',')}] ===`);
	//
	// 	const portraitAccuracy = testOrientationAccuracy(portraitQuaternions, 1, 'Portrait', gravityVector);
	// 	const leftLandscapeAccuracy = testOrientationAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape', gravityVector);
	// 	const rightLandscapeAccuracy = testOrientationAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape', gravityVector);
	// 	const upsideDownAccuracy = testOrientationAccuracy(upsideDownQuaternions, 3, 'Upside Down', gravityVector);
	//
	// 	const averageAccuracy = (portraitAccuracy + leftLandscapeAccuracy + rightLandscapeAccuracy + upsideDownAccuracy) / 4;
	// 	console.log(`Average accuracy: ${(averageAccuracy * 100).toFixed(1)}%`);
	//
	// });
	//
	// // Test rotation matrix approach
	// console.log('\n=== Testing rotation matrix approach ===');
	//
	// function testMatrixAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
	// 	const results = quaternions.map(q => testRotationMatrix(q));
	// 	const correctCount = results.filter(result => result === expectedExif).length;
	// 	const accuracy = correctCount / quaternions.length;
	// 	console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);
	// 	return accuracy;
	// }
	//
	// const portraitAccuracy = testMatrixAccuracy(portraitQuaternions, 1, 'Portrait');
	// const leftLandscapeAccuracy = testMatrixAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	// const rightLandscapeAccuracy = testMatrixAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	// const upsideDownAccuracy = testMatrixAccuracy(upsideDownQuaternions, 3, 'Upside Down');
	//
	// const matrixAverageAccuracy = (portraitAccuracy + leftLandscapeAccuracy + rightLandscapeAccuracy + upsideDownAccuracy) / 4;
	//
	// console.log(`Average accuracy: ${(matrixAverageAccuracy * 100).toFixed(1)}%`);
	//
	// if (matrixAverageAccuracy > 0.8) {
	// 	console.log(`🎯 GOOD CANDIDATE with ${(matrixAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	// }
	//
	// // Test Euler angle approach
	// console.log('\n=== Testing Euler angle approach ===');
	//
	// function testEulerAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
	// 	const results = quaternions.map(q => testEulerApproach(q));
	// 	const correctCount = results.filter(result => result === expectedExif).length;
	// 	const accuracy = correctCount / quaternions.length;
	// 	console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);
	//
	// 	// Show first few debug results
	// 	if (accuracy < 0.9) {
	// 		console.log('  First few results vs expected:');
	// 		for (let i = 0; i < Math.min(5, quaternions.length); i++) {
	// 			const euler = quatToEuler(quaternions[i]);
	// 			const result = results[i];
	// 			console.log(`    Roll: ${(euler.roll * 180 / Math.PI).toFixed(1)}°, Pitch: ${(euler.pitch * 180 / Math.PI).toFixed(1)}° → EXIF ${result} (expected ${expectedExif})`);
	// 		}
	// 	}
	//
	// 	return accuracy;
	// }
	//
	// const eulerPortraitAccuracy = testEulerAccuracy(portraitQuaternions, 1, 'Portrait');
	// const eulerLeftLandscapeAccuracy = testEulerAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	// const eulerRightLandscapeAccuracy = testEulerAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	// const eulerUpsideDownAccuracy = testEulerAccuracy(upsideDownQuaternions, 3, 'Upside Down');
	//
	// const eulerAverageAccuracy = (eulerPortraitAccuracy + eulerLeftLandscapeAccuracy + eulerRightLandscapeAccuracy + eulerUpsideDownAccuracy) / 4;
	//
	// console.log(`Euler average accuracy: ${(eulerAverageAccuracy * 100).toFixed(1)}%`);
	//
	// if (eulerAverageAccuracy > 0.8) {
	// 	console.log(`🎯 EULER ANGLE APPROACH IS GOOD! ${(eulerAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	// }

	// Test Euler angle approach WITH upright correction
	console.log('\n=== Testing Euler angle approach WITH upright correction ===');

	function testEulerUprightAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
		const results = quaternions.map(q => testEulerWithUprightCorrection(q));
		const correctCount = results.filter(result => result === expectedExif).length;
		const accuracy = correctCount / quaternions.length;
		console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);

		// Show first few debug results
		if (accuracy < 0.9) {
			console.log('  First few corrected results vs expected:');
			for (let i = 0; i < Math.min(5, quaternions.length); i++) {
				const [x, y, z, w] = quaternions[i];
				const q_device = new Quaternion(w, x, y, z);
				const uprightCorrection = new Quaternion({
					w: Math.cos(Math.PI / 4),
					x: Math.sin(Math.PI / 4),
					y: 0,
					z: 0
				});
				const q_corrected = q_device.mul(uprightCorrection);
				const correctedArray = [q_corrected.x, q_corrected.y, q_corrected.z, q_corrected.w];
				const euler = quatToEuler(correctedArray);
				const result = results[i];
				console.log(`    Roll: ${(euler.roll * 180 / Math.PI).toFixed(1)}°, Pitch: ${(euler.pitch * 180 / Math.PI).toFixed(1)}° → EXIF ${result} (expected ${expectedExif})`);
			}
		}

		return accuracy;
	}

	const eulerUprightPortraitAccuracy = testEulerUprightAccuracy(portraitQuaternions, 1, 'Portrait');
	const eulerUprightLeftLandscapeAccuracy = testEulerUprightAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	const eulerUprightRightLandscapeAccuracy = testEulerUprightAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	const eulerUprightUpsideDownAccuracy = testEulerUprightAccuracy(upsideDownQuaternions, 3, 'Upside Down');

	const eulerUprightAverageAccuracy = (eulerUprightPortraitAccuracy + eulerUprightLeftLandscapeAccuracy + eulerUprightRightLandscapeAccuracy + eulerUprightUpsideDownAccuracy) / 4;

	console.log(`Euler WITH upright correction average accuracy: ${(eulerUprightAverageAccuracy * 100).toFixed(1)}%`);

	if (eulerUprightAverageAccuracy > 0.8) {
		console.log(`🎯 EULER WITH UPRIGHT CORRECTION IS GOOD! ${(eulerUprightAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	}

	// // Test raw quaternion approach to debug coordinate systems
	// console.log('\n=== RAW QUATERNION ANALYSIS ===');
	// console.log('Let\'s examine the actual quaternion values to understand patterns:');
	//
	// console.log('\nPortrait quaternions (sampled evenly):');
	// for (let i = 0; i < 5; i++) {
	// 	const idx = Math.floor((i / 4) * (portraitQuaternions.length - 1));
	// 	const [x, y, z, w] = portraitQuaternions[idx];
	// 	console.log(`  [${x.toFixed(3)}, ${y.toFixed(3)}, ${z.toFixed(3)}, ${w.toFixed(3)}] - x:${x.toFixed(2)} y:${y.toFixed(2)} z:${z.toFixed(2)} w:${w.toFixed(2)}`);
	// }
	//
	// console.log('\nLeft landscape quaternions (sampled evenly):');
	// for (let i = 0; i < 5; i++) {
	// 	const idx = Math.floor((i / 4) * (leftLandscapeQuaternions.length - 1));
	// 	const [x, y, z, w] = leftLandscapeQuaternions[idx];
	// 	console.log(`  [${x.toFixed(3)}, ${y.toFixed(3)}, ${z.toFixed(3)}, ${w.toFixed(3)}] - x:${x.toFixed(2)} y:${y.toFixed(2)} z:${z.toFixed(2)} w:${w.toFixed(2)}`);
	// }
	//
	// console.log('\nRight landscape quaternions (sampled evenly):');
	// for (let i = 0; i < 5; i++) {
	// 	const idx = Math.floor((i / 4) * (rightLandscapeQuaternions.length - 1));
	// 	const [x, y, z, w] = rightLandscapeQuaternions[idx];
	// 	console.log(`  [${x.toFixed(3)}, ${y.toFixed(3)}, ${z.toFixed(3)}, ${w.toFixed(3)}] - x:${x.toFixed(2)} y:${y.toFixed(2)} z:${z.toFixed(2)} w:${w.toFixed(2)}`);
	// }
	//
	// console.log('\nUpside-down quaternions (sampled evenly):');
	// for (let i = 0; i < 5; i++) {
	// 	const idx = Math.floor((i / 4) * (upsideDownQuaternions.length - 1));
	// 	const [x, y, z, w] = upsideDownQuaternions[idx];
	// 	console.log(`  [${x.toFixed(3)}, ${y.toFixed(3)}, ${z.toFixed(3)}, ${w.toFixed(3)}] - x:${x.toFixed(2)} y:${y.toFixed(2)} z:${z.toFixed(2)} w:${w.toFixed(2)}`);
	// }
	//
	// Test raw quaternion approach
	console.log('\n=== Testing raw quaternion approach ===');

	function testRawAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
		const results = quaternions.map(q => testRawQuaternion(q));
		const correctCount = results.filter(result => result === expectedExif).length;
		const accuracy = correctCount / quaternions.length;
		console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);
		return accuracy;
	}

	const rawPortraitAccuracy = testRawAccuracy(portraitQuaternions, 1, 'Portrait');
	const rawLeftLandscapeAccuracy = testRawAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	const rawRightLandscapeAccuracy = testRawAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	const rawUpsideDownAccuracy = testRawAccuracy(upsideDownQuaternions, 3, 'Upside Down');

	const rawAverageAccuracy = (rawPortraitAccuracy + rawLeftLandscapeAccuracy + rawRightLandscapeAccuracy + rawUpsideDownAccuracy) / 4;

	console.log(`Raw quaternion average accuracy: ${(rawAverageAccuracy * 100).toFixed(1)}%`);

	if (rawAverageAccuracy > 0.8) {
		console.log(`🎯 RAW QUATERNION APPROACH WORKS! ${(rawAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	}

	// Test hybrid approach combining best of both
	console.log('\n=== Testing hybrid approach (raw quaternion for landscape, upright Euler for portrait/upside-down) ===');

	function testHybridAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
		const results = quaternions.map(q => testHybridApproach(q));
		const correctCount = results.filter(result => result === expectedExif).length;
		const accuracy = correctCount / quaternions.length;
		console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);
		return accuracy;
	}

	const hybridPortraitAccuracy = testHybridAccuracy(portraitQuaternions, 1, 'Portrait');
	const hybridLeftLandscapeAccuracy = testHybridAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	const hybridRightLandscapeAccuracy = testHybridAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	const hybridUpsideDownAccuracy = testHybridAccuracy(upsideDownQuaternions, 3, 'Upside Down');

	const hybridAverageAccuracy = (hybridPortraitAccuracy + hybridLeftLandscapeAccuracy + hybridRightLandscapeAccuracy + hybridUpsideDownAccuracy) / 4;

	console.log(`Hybrid approach average accuracy: ${(hybridAverageAccuracy * 100).toFixed(1)}%`);

	if (hybridAverageAccuracy > 0.8) {
		console.log(`🎯 HYBRID APPROACH WORKS! ${(hybridAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	}

	// Test optimal hybrid approach - very selective landscape + original Euler
	console.log('\n=== Testing optimal hybrid approach (minimal landscape interference) ===');

	function testOptimalHybridAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
		const results = quaternions.map(q => testOptimalHybridApproach(q));
		const correctCount = results.filter(result => result === expectedExif).length;
		const accuracy = correctCount / quaternions.length;
		console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);
		return accuracy;
	}

	const optimalPortraitAccuracy = testOptimalHybridAccuracy(portraitQuaternions, 1, 'Portrait');
	const optimalLeftLandscapeAccuracy = testOptimalHybridAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	const optimalRightLandscapeAccuracy = testOptimalHybridAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	const optimalUpsideDownAccuracy = testOptimalHybridAccuracy(upsideDownQuaternions, 3, 'Upside Down');

	const optimalAverageAccuracy = (optimalPortraitAccuracy + optimalLeftLandscapeAccuracy + optimalRightLandscapeAccuracy + optimalUpsideDownAccuracy) / 4;

	console.log(`Optimal hybrid average accuracy: ${(optimalAverageAccuracy * 100).toFixed(1)}%`);

	if (optimalAverageAccuracy > 0.8) {
		console.log(`🎯 OPTIMAL HYBRID WORKS! ${(optimalAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	}

	// Test reference quaternion approach - the proper way!
	console.log('\n=== Testing reference quaternion approach (relative rotation) ===');

	function testReferenceAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
		const results = quaternions.map(q => testReferenceQuaternionApproach(q));
		const correctCount = results.filter(result => result === expectedExif).length;
		const accuracy = correctCount / quaternions.length;
		console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);

		// Show first few debug results
		if (accuracy < 0.9) {
			console.log('  First few results vs expected:');
			for (let i = 0; i < Math.min(5, quaternions.length); i++) {
				const result = results[i];
				const [x, y, z, w] = quaternions[i];
				console.log(`    [${x.toFixed(2)}, ${y.toFixed(2)}, ${z.toFixed(2)}, ${w.toFixed(2)}] → EXIF ${result} (expected ${expectedExif})`);
			}
		}

		return accuracy;
	}

	const refPortraitAccuracy = testReferenceAccuracy(portraitQuaternions, 1, 'Portrait');
	const refLeftLandscapeAccuracy = testReferenceAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	const refRightLandscapeAccuracy = testReferenceAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	const refUpsideDownAccuracy = testReferenceAccuracy(upsideDownQuaternions, 3, 'Upside Down');

	const refAverageAccuracy = (refPortraitAccuracy + refLeftLandscapeAccuracy + refRightLandscapeAccuracy + refUpsideDownAccuracy) / 4;

	console.log(`Reference quaternion average accuracy: ${(refAverageAccuracy * 100).toFixed(1)}%`);

	if (refAverageAccuracy > 0.9) {
		console.log(`🎯🎯🎯 REFERENCE QUATERNION APPROACH IS EXCELLENT! ${(refAverageAccuracy * 100).toFixed(1)}% accuracy! 🎯🎯🎯`);
	} else if (refAverageAccuracy > 0.8) {
		console.log(`🎯 REFERENCE QUATERNION APPROACH WORKS! ${(refAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	}

	// Test optimal quaternion approach - combining best methods
	console.log('\n=== Testing optimal quaternion approach (quaternion landscapes + Euler portrait/upside-down) ===');

	function testOptimalQuaternionAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
		const results = quaternions.map(q => testOptimalQuaternionApproach(q));
		const correctCount = results.filter(result => result === expectedExif).length;
		const accuracy = correctCount / quaternions.length;
		console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);
		return accuracy;
	}

	const productionPortraitAccuracy = testOptimalQuaternionAccuracy(portraitQuaternions, 1, 'Portrait');
	const productionLeftLandscapeAccuracy = testOptimalQuaternionAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	const productionRightLandscapeAccuracy = testOptimalQuaternionAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	const productionUpsideDownAccuracy = testOptimalQuaternionAccuracy(upsideDownQuaternions, 3, 'Upside Down');

	const productionAverageAccuracy = (productionPortraitAccuracy + productionLeftLandscapeAccuracy + productionRightLandscapeAccuracy + productionUpsideDownAccuracy) / 4;

	console.log(`Production quaternion average accuracy: ${(productionAverageAccuracy * 100).toFixed(1)}%`);

	if (productionAverageAccuracy > 0.9) {
		console.log(`🎯🎯🎯 PRODUCTION APPROACH IS EXCELLENT! ${(productionAverageAccuracy * 100).toFixed(1)}% accuracy! 🎯🎯🎯`);
	} else if (productionAverageAccuracy > 0.8) {
		console.log(`🎯 PRODUCTION APPROACH WORKS! ${(productionAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	}

	// Test the actual production function
	console.log('\n=== Testing Production Function (getExifOrientationFromQuaternion) ===');

	function testProductionAccuracy(quaternions: number[][], expectedExif: number, orientationName: string): number {
		let correctCount = 0;
		for (const quaternion of quaternions) {
			const result = getExifOrientationFromQuaternion(quaternion);
			if (result === expectedExif) {
				correctCount++;
			}
		}
		const accuracy = correctCount / quaternions.length;
		console.log(`${orientationName} (EXIF ${expectedExif}): ${correctCount}/${quaternions.length} correct (${(accuracy * 100).toFixed(1)}%)`);
		return accuracy;
	}

	const actualPortraitAccuracy = testProductionAccuracy(portraitQuaternions, 1, 'Portrait');
	const actualLeftLandscapeAccuracy = testProductionAccuracy(leftLandscapeQuaternions, 8, 'Left Landscape');
	const actualRightLandscapeAccuracy = testProductionAccuracy(rightLandscapeQuaternions, 6, 'Right Landscape');
	const actualUpsideDownAccuracy = testProductionAccuracy(upsideDownQuaternions, 3, 'Upside Down');

	const actualAverageAccuracy = (actualPortraitAccuracy + actualLeftLandscapeAccuracy + actualRightLandscapeAccuracy + actualUpsideDownAccuracy) / 4;

	console.log(`\nActual production function average accuracy: ${(actualAverageAccuracy * 100).toFixed(1)}%`);

	if (actualAverageAccuracy > 0.9) {
		console.log(`🎯🎯🎯 ACTUAL PRODUCTION IS EXCELLENT! ${(actualAverageAccuracy * 100).toFixed(1)}% accuracy! 🎯🎯🎯`);
	} else if (actualAverageAccuracy > 0.8) {
		console.log(`🎯 ACTUAL PRODUCTION WORKS! ${(actualAverageAccuracy * 100).toFixed(1)}% accuracy!`);
	} else if (actualAverageAccuracy > 0.7) {
		console.log(`✅ ACTUAL PRODUCTION GOOD: ${(actualAverageAccuracy * 100).toFixed(1)}% accuracy`);
	} else {
		console.log(`⚠️ ACTUAL PRODUCTION NEEDS WORK: ${(actualAverageAccuracy * 100).toFixed(1)}% accuracy`);
	}
}


if (require.main === module) {
	test();
}
